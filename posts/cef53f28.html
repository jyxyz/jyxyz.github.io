<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>MFC | 一杯热牛奶</title><meta name="keywords" content="MFC"><meta name="author" content="阿耶"><meta name="copyright" content="阿耶"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="[toc] What is MFC? Microsoft Foundation Classes，an application framework 微软公司对windows api函数封装后的一个C++类库，原本SDK编程中的消息循环等东西被封装在MFC框架中，让程序员关注自己业务逻辑即可。 Why MFC? 重要的：  体会封装，感知优雅的设计 逆向人员：至少了解一种框架（MFC、QT、JAVA也">
<meta property="og:type" content="article">
<meta property="og:title" content="MFC">
<meta property="og:url" content="https://jyxyz.github.io/posts/cef53f28.html">
<meta property="og:site_name" content="一杯热牛奶">
<meta property="og:description" content="[toc] What is MFC? Microsoft Foundation Classes，an application framework 微软公司对windows api函数封装后的一个C++类库，原本SDK编程中的消息循环等东西被封装在MFC框架中，让程序员关注自己业务逻辑即可。 Why MFC? 重要的：  体会封装，感知优雅的设计 逆向人员：至少了解一种框架（MFC、QT、JAVA也">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://jyxyz.github.io/img/default.jpg">
<meta property="article:published_time" content="2021-10-28T09:12:09.000Z">
<meta property="article:modified_time" content="2021-11-17T10:40:09.000Z">
<meta property="article:author" content="阿耶">
<meta property="article:tag" content="MFC">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jyxyz.github.io/img/default.jpg"><link rel="shortcut icon" href="/img/portrait.png"><link rel="canonical" href="https://jyxyz.github.io/posts/cef53f28"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":270},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":200,"languages":{"author":"作者: 阿耶","link":"链接: ","source":"来源: 一杯热牛奶","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#BEE5D3","bgDark":"#BEE5D3","position":"bottom-right"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MFC',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-11-17 18:40:09'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/copyright.css"  media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/heoMainColor.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/poem.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.0.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/portrait.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">19</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">22</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">21</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">一杯热牛奶</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">MFC</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-10-28T09:12:09.000Z" title="发表于 2021-10-28 17:12:09">2021-10-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-11-17T10:40:09.000Z" title="更新于 2021-11-17 18:40:09">2021-11-17</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Windows%E5%AE%89%E5%85%A8/">Windows安全</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Windows%E5%AE%89%E5%85%A8/%E7%BC%96%E7%A8%8B%E7%AF%87/">编程篇</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Windows%E5%AE%89%E5%85%A8/%E7%BC%96%E7%A8%8B%E7%AF%87/MFC/">MFC</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">13.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>50分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="MFC"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/posts/cef53f28.html#post-comment"><span id="twikoo-count"></span></a></span></div></div></div><article class="post-content" id="article-container"><p>[toc]</p>
<h2 id="What-is-MFC">What is MFC?</h2>
<p>Microsoft Foundation Classes，an application framework</p>
<p>微软公司对windows api函数封装后的一个C++类库，原本SDK编程中的消息循环等东西被封装在MFC框架中，让程序员关注自己业务逻辑即可。</p>
<h2 id="Why-MFC">Why MFC?</h2>
<p>重要的：</p>
<ul>
<li>体会封装，感知优雅的设计</li>
<li>逆向人员：至少了解一种框架（MFC、QT、JAVA也行）</li>
<li>前辈是生活在MFC走红的时代，看他们的资料不免会遇到MFC，这玩意梭哈学一下也不太费事，深入学一下，后边轻松点</li>
</ul>
<p>次要的：</p>
<ul>
<li>环境不依赖性，性能好</li>
<li>MFC仍广泛用于数控、工控领域</li>
</ul>
<h2 id="知识补充">知识补充</h2>
<h3 id="开发环境及项目创建">开发环境及项目创建</h3>
<p>VS2015 community</p>
<details class="folding-tag" ><summary> 创建Win32空项目 </summary>
              <div class='content'>
              <p>Win32项目-&gt;空项目</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211107152939905.png" alt="image-20211107152939905"></p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211107153219441.png" alt="image-20211107153219441"></p><p>对项目右键-&gt;选择属性</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211107153640655.png" alt="image-20211107153640655"></p>
              </div>
            </details>
<details class="folding-tag" ><summary> 创建MFC项目-对话框应用程序 </summary>
              <div class='content'>
              <p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108173901400.png" alt="image-20211108173901400"></p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108173919424.png" alt="image-20211108173919424"></p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108174007226.png" alt="image-20211108174007226"></p><p>保持默认，下一步</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108174034447.png" alt="image-20211108174034447"></p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108174045530.png" alt="image-20211108174045530"></p><p>点击完成</p><p>（题外话：CMy03MFCCheckboxDemoApp是进程实例，CMy03MFCCheckboxDemoDlg是我们画出来的窗口）</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108174140449.png" alt="image-20211108174140449"></p>
              </div>
            </details>
<h3 id="匈牙利命名法">匈牙利命名法</h3>
<p>变量：</p>
<p>m_表示该变量是类的成员变量（member）</p>
<p>常量：</p>
<p>SW_SHOW是一个常量宏，SW表示它被用于系统函数ShowWindow的参数</p>
<h3 id="Windows-API与MFC成员函数">Windows API与MFC成员函数</h3>
<p>要从MFC程序调用一个常规的Windows API函数，需要在函数名称前添加一个全局运算符<code>::</code>，确保即使对象具有相同名称的成员函数，也可以调用API函数</p>
<h2 id="基础篇">基础篇</h2>
<h3 id="第一个MFC程序（窗体）">第一个MFC程序（窗体）</h3>
<details class="folding-tag" ><summary> 参考资料 </summary>
              <div class='content'>
              <p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45391763/article/details/101482454">第一个MFC程序</a></p>
              </div>
            </details>
<details class="folding-tag" ><summary> 第一个MFC程序（窗体） </summary>
              <div class='content'>
              <blockquote><p>创建Win32-&gt;空项目，项目名为01First，创建两个文件：mfc.h、01FirstMFC.cpp</p></blockquote><p>内容如下</p><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">mfc.h</button></li><li class="tab"><button type="button" data-href="#test4-2">01FirstMFC.cpp</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;afxwin.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义MyFirstApp类作为 应用程序类CWinApp的子类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyFirstApp</span> :</span><span class="keyword">public</span> CWinApp &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="comment">//基类的虚函数（接口），子类去实现</span></span><br><span class="line">	<span class="comment">//MFC程序的入口函数</span></span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> BOOL <span class="title">InitInstance</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//框架窗口类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainWindow</span> :</span><span class="keyword">public</span> CFrameWnd &#123;<span class="comment">//这是一个用C++对象表明的Windows窗口</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">MainWindow</span>();<span class="comment">//构造函数</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;mfc.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">MyFirstApp theApp;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">MyFirstApp::InitInstance</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//1.创建一个框架窗口类对象</span></span><br><span class="line">	MainWindow* pMain = <span class="keyword">new</span> <span class="built_in">MainWindow</span>();<span class="comment">//调用上面定义的方法</span></span><br><span class="line">	<span class="comment">//2.显示窗口</span></span><br><span class="line">	pMain-&gt;<span class="built_in">ShowWindow</span>(m_nCmdShow);</span><br><span class="line">	<span class="comment">//3.更新窗口</span></span><br><span class="line">	pMain-&gt;<span class="built_in">UpdateWindow</span>();</span><br><span class="line">	<span class="comment">//4.保存框架类对象的指针</span></span><br><span class="line">	<span class="keyword">this</span>-&gt;m_pMainWnd = pMain;<span class="comment">//建立Window对象和App对象的关联关系</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> TRUE;<span class="comment">//初始化正常则返回TRUE</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MainWindow::<span class="built_in">MainWindow</span>()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">Create</span>(<span class="literal">NULL</span>, <span class="built_in">TEXT</span>(<span class="string">&quot;我的第一个MFC程序&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>运行结果：</p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211028183517793.png" alt="image-20211028183517793" style="zoom: 50%;" />
              </div>
            </details>
<h3 id="MFC对象与Windows对象">MFC对象与Windows对象</h3>
<p>在Windows应用程序中，窗口是通过窗口句柄（HWND）来标识的。</p>
<p>MFC开发Windows应用程序就是对一个个MFC对象的熟悉、改造的过程——MFC对象就是把一个个零散的windows对象变成了易于标准化程序开发的C++对象。</p>
<p>下面以按钮、Cbutton为例子，来体会Windows对象与MFC对象的概念：</p>
<details class="folding-tag" ><summary> 例子：winapi或MFC方式创建一个按钮 </summary>
              <div class='content'>
              <blockquote><p>接着用上边的项目01FirstMFC</p></blockquote><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">windows api的方式</button></li><li class="tab"><button type="button" data-href="#test4-2">MFC对象</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">mfc.h</button></li><li class="tab"><button type="button" data-href="#test4-2">01FirstMFC.cpp</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><p>没变</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#pragma once</span><br><span class="line"></span><br><span class="line">#include &lt;afxwin.h&gt;</span><br><span class="line"></span><br><span class="line">//定义MyFirstApp类作为 应用程序类CWinApp的子类</span><br><span class="line">class MyFirstApp :public CWinApp &#123;</span><br><span class="line">public:</span><br><span class="line">	//基类的虚函数（接口），子类去实现</span><br><span class="line">	//MFC程序的入口函数</span><br><span class="line">	virtual BOOL InitInstance();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//框架窗口类</span><br><span class="line">class MainWindow :public CFrameWnd &#123;//这是一个用C++对象表明的Windows窗口</span><br><span class="line">public:</span><br><span class="line">	MainWindow();//构造函数</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;mfc.h&quot;</span><br><span class="line"></span><br><span class="line">MyFirstApp theApp;</span><br><span class="line"></span><br><span class="line">BOOL MyFirstApp::InitInstance()</span><br><span class="line">&#123;</span><br><span class="line">	//1.创建一个框架窗口类对象</span><br><span class="line">	MainWindow* pMain = new MainWindow();//调用上面定义的方法</span><br><span class="line">	//2.显示窗口</span><br><span class="line">	pMain-&gt;ShowWindow(m_nCmdShow);</span><br><span class="line">	//3.更新窗口</span><br><span class="line">	pMain-&gt;UpdateWindow();</span><br><span class="line">	//4.保存框架类对象的指针</span><br><span class="line">	this-&gt;m_pMainWnd = pMain;//建立Window对象和App对象的关联关系</span><br><span class="line"></span><br><span class="line">	return TRUE;//初始化正常则返回TRUE</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MainWindow::MainWindow()</span><br><span class="line">&#123;</span><br><span class="line">	Create(NULL, TEXT(&quot;我的第一个MFC程序&quot;));</span><br><span class="line"></span><br><span class="line">	//通过windows api创建一个按钮</span><br><span class="line"><span class="addition">+	HWND hBtn = ::CreateWindow(TEXT(&quot;Button&quot;),</span></span><br><span class="line"><span class="addition">+		TEXT(&quot;按钮&quot;),</span></span><br><span class="line"><span class="addition">+		WS_VISIBLE | WS_CHILD | BS_PUSHBUTTON,</span></span><br><span class="line"><span class="addition">+		150, 45,</span></span><br><span class="line"><span class="addition">+		160, 65,</span></span><br><span class="line"><span class="addition">+		this-&gt;m_hWnd,</span></span><br><span class="line"><span class="addition">+		(HMENU)10001,</span></span><br><span class="line"><span class="addition">+		AfxGetInstanceHandle(),</span></span><br><span class="line"><span class="addition">+		NULL);</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>运行结果：</p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211028185052142.png" alt="image-20211028185052142" style="zoom: 50%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">mfc.h</button></li><li class="tab"><button type="button" data-href="#test4-2">01FirstMFC.cpp</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#pragma once</span><br><span class="line"></span><br><span class="line">#include &lt;afxwin.h&gt;</span><br><span class="line"></span><br><span class="line">//定义MyFirstApp类作为 应用程序类CWinApp的子类</span><br><span class="line">class MyFirstApp :public CWinApp &#123;</span><br><span class="line">public:</span><br><span class="line">	//基类的虚函数（接口），子类去实现</span><br><span class="line">	//MFC程序的入口函数</span><br><span class="line">	virtual BOOL InitInstance();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//框架窗口类</span><br><span class="line">class MainWindow :public CFrameWnd &#123;//这是一个用C++对象表明的Windows窗口</span><br><span class="line">public:</span><br><span class="line">	MainWindow();//构造函数</span><br><span class="line"></span><br><span class="line">private:</span><br><span class="line"><span class="addition">+	//子窗口，当成成员变量</span></span><br><span class="line"><span class="addition">+	CButton *pBtn;</span></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;mfc.h&quot;</span><br><span class="line"></span><br><span class="line">MyFirstApp theApp;</span><br><span class="line"></span><br><span class="line">BOOL MyFirstApp::InitInstance()</span><br><span class="line">&#123;</span><br><span class="line">	//1.创建一个框架窗口类对象</span><br><span class="line">	MainWindow* pMain = new MainWindow();//调用上面定义的方法</span><br><span class="line">	//2.显示窗口</span><br><span class="line">	pMain-&gt;ShowWindow(m_nCmdShow);</span><br><span class="line">	//3.更新窗口</span><br><span class="line">	pMain-&gt;UpdateWindow();</span><br><span class="line">	//4.保存框架类对象的指针</span><br><span class="line">	this-&gt;m_pMainWnd = pMain;//建立Window对象和App对象的关联关系</span><br><span class="line"></span><br><span class="line">	return TRUE;//初始化正常则返回TRUE</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MainWindow::MainWindow()</span><br><span class="line">&#123;</span><br><span class="line">	Create(NULL, TEXT(&quot;我的第一个MFC程序&quot;));</span><br><span class="line"></span><br><span class="line">	//通过windows api创建一个按钮</span><br><span class="line">	HWND hBtn = ::CreateWindow(TEXT(&quot;Button&quot;),</span><br><span class="line">		TEXT(&quot;按钮&quot;),</span><br><span class="line">		WS_VISIBLE | WS_CHILD | BS_PUSHBUTTON,</span><br><span class="line">		150, 45,</span><br><span class="line">		160, 65,</span><br><span class="line">		this-&gt;m_hWnd,</span><br><span class="line">		(HMENU)10001,</span><br><span class="line">		AfxGetInstanceHandle(),</span><br><span class="line">		NULL);</span><br><span class="line"></span><br><span class="line"><span class="addition">+	CRect r(300, 450, 500, 600);</span></span><br><span class="line"><span class="addition">+	pBtn = new CButton();</span></span><br><span class="line"><span class="addition">+	pBtn-&gt;Create(TEXT(&quot;CButton&quot;),</span></span><br><span class="line"><span class="addition">+		WS_CHILD | WS_VISIBLE | BS_PUSHBUTTON,</span></span><br><span class="line"><span class="addition">+		r,</span></span><br><span class="line"><span class="addition">+		this,</span></span><br><span class="line"><span class="addition">+		10002);</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>运行结果：</p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211028185745314.png" alt="image-20211028185745314" style="zoom:50%;" /><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>
              </div>
            </details>
<h3 id="消息映射：从windows对象到MFC对象">消息映射：从windows对象到MFC对象</h3>
<p><strong>消息映射从语义上看就是事件驱动编程，从语法上是一个将消息和成员函数相互关联的表</strong>。比如，框架窗口接收到一个窗口绘制消息，MFC将搜索该窗口的消息映射，如果存在一个处理WM_PAINT消息的处理程序，然后就调用OnPaint。</p>
<p>MFC为100多种从WM_ACTIVATE到WM_WININICHANGE的Windows消息提供了宏。您可以从MFC文档中获取与特定的ON_WM宏相对应的消息处理程序的名称,然而要自己推断名称也是相当容易的,您可以将WM_替换为On,将除那些单词开头字母之外的所有其他字母变为小写字母。因此,如 WM_PAINT变为OnPaint、WM_LBUTTONDOWN变为OnLButtonDown等等。</p>
<p>MFC为执行消息映射在内部所做的工作隐藏在某些十分复杂的宏。</p>
<p>实现过程如下：</p>
<ol>
<li>通过将DECLARE_MESSAGE_MAP添加到类声明中，声明消息映射。</li>
<li>通过放置标识消息的宏来执行消息映射，相应的类将在对BEGIN_MESSAGE_MAP和END_MESSAGE_MAP的调用之间处理消息。</li>
<li>添加成员函数来处理消息。</li>
</ol>
<p>自定义消息：</p>
<p>如果您希望处理一个MFC没有为之提供消息映射宏的消息时会怎么样呢?您可以使用普通的ON_MESSAGE宏为消息创建一个条目,该宏接受两个参数:消息ID和对应类成员函数的地址。下面的语句就将WM_SETTEXT映射到了一个名为OnSetText 的成员函数:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ON_MESSAGE</span>(WM_SETTEXT,OnSetText)</span><br></pre></td></tr></table></figure>
<p><code>OnSetText</code>应以如下的方式进行声明：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">afx_msg LRSULT <span class="title">OnSetText</span><span class="params">(WPARAM wParam,LPARAM lParam)</span></span>;</span><br></pre></td></tr></table></figure>
<p>由MFC提供的其他特殊用途的消息映射宏包括:ON_COMMAND,它将菜单选择和其他的UI事件映射到类成员函数;ON_UPDATE_COMMAND_UI,它将菜单项和其他UI对象连接到保持它们与应用程序的内部状态同步的“更新处理程序”。</p>
<details class="folding-tag" ><summary> 例子：给MFC的按钮对象增加按下便弹窗的功能： </summary>
              <div class='content'>
              <div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">mfc.h</button></li><li class="tab"><button type="button" data-href="#test4-2">01FirstMFC.cpp</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#pragma once</span><br><span class="line"></span><br><span class="line">#include &lt;afxwin.h&gt;</span><br><span class="line"></span><br><span class="line">//定义MyFirstApp类作为 应用程序类CWinApp的子类</span><br><span class="line">class MyFirstApp :public CWinApp </span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">	//基类的虚函数（接口），子类去实现</span><br><span class="line">	//MFC程序的入口函数</span><br><span class="line">	virtual BOOL InitInstance();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//框架窗口类</span><br><span class="line">class MainWindow :public CFrameWnd </span><br><span class="line">&#123;//这是一个用C++对象表明的Windows窗口</span><br><span class="line">public:</span><br><span class="line">	MainWindow();//构造函数</span><br><span class="line"></span><br><span class="line"><span class="addition">+	afx_msg void HandleButton();//自己写的成员函数</span></span><br><span class="line"><span class="addition">+	DECLARE_MESSAGE_MAP()//宏</span></span><br><span class="line"></span><br><span class="line">private:</span><br><span class="line">	//子窗口，当成成员变量</span><br><span class="line">	CButton *pBtn;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;mfc.h&quot;</span><br><span class="line"></span><br><span class="line"><span class="addition">+BEGIN_MESSAGE_MAP(MainWindow,CFrameWnd)</span></span><br><span class="line"><span class="addition">+	ON_BN_CLICKED(10002,HandleButton)//ID号和成员函数</span></span><br><span class="line"><span class="addition">+END_MESSAGE_MAP()</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+void MainWindow::HandleButton()</span></span><br><span class="line"><span class="addition">+&#123;</span></span><br><span class="line"><span class="addition">+	::MessageBox(NULL, TEXT(&quot;Hello&quot;), TEXT(&quot;MFC&quot;), MB_OK);</span></span><br><span class="line"><span class="addition">+&#125;</span></span><br><span class="line"></span><br><span class="line">MyFirstApp theApp;</span><br><span class="line"></span><br><span class="line">BOOL MyFirstApp::InitInstance()</span><br><span class="line">&#123;</span><br><span class="line">	//1.创建一个框架窗口类对象</span><br><span class="line">	MainWindow* pMain = new MainWindow();//调用上面定义的方法</span><br><span class="line">	//2.显示窗口</span><br><span class="line">	pMain-&gt;ShowWindow(m_nCmdShow);</span><br><span class="line">	//3.更新窗口</span><br><span class="line">	pMain-&gt;UpdateWindow();</span><br><span class="line">	//4.保存框架类对象的指针</span><br><span class="line">	this-&gt;m_pMainWnd = pMain;//建立Window对象和App对象的关联关系</span><br><span class="line"></span><br><span class="line">	return TRUE;//初始化正常则返回TRUE</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MainWindow::MainWindow()</span><br><span class="line">&#123;</span><br><span class="line">	Create(NULL, TEXT(&quot;我的第一个MFC程序&quot;));</span><br><span class="line"></span><br><span class="line">	//通过windows api创建一个按钮</span><br><span class="line">	HWND hBtn = ::CreateWindow(TEXT(&quot;Button&quot;),</span><br><span class="line">		TEXT(&quot;按钮&quot;),</span><br><span class="line">		WS_VISIBLE | WS_CHILD | BS_PUSHBUTTON,</span><br><span class="line">		150, 45,</span><br><span class="line">		160, 65,</span><br><span class="line">		this-&gt;m_hWnd,</span><br><span class="line">		(HMENU)10001,</span><br><span class="line">		AfxGetInstanceHandle(),</span><br><span class="line">		NULL);</span><br><span class="line"></span><br><span class="line">	CRect r(300, 450, 500, 600);</span><br><span class="line">	pBtn = new CButton();</span><br><span class="line">	pBtn-&gt;Create(TEXT(&quot;CButton&quot;),</span><br><span class="line">		WS_CHILD | WS_VISIBLE | BS_PUSHBUTTON,</span><br><span class="line">		r,</span><br><span class="line">		this,</span><br><span class="line">		10002);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>&gt; 运行结果：</p><p>点击CButton会弹窗<img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211028190407850.png" alt="image-20211028190407850" style="zoom:50%;" /></p>
              </div>
            </details>
<p>在类声明.h中：</p>
<p>术语afx_msg是用来表示一个其行为很像虚拟函数但却不需要虚表项的函数。</p>
<p>DECLARE_MESSAGE MAP通常是最后的语句,因为它使用C++关键字来指定其成员的可见度。您可以在 DECLARE_MESSAGE_MAP后面插入声明其他类成员的语句,但是如果这样做了,您还应当使用关键字public,protected或者private开头,以确保您希望为这些成员设置的可见度。</p>
<p>小结：</p>
<ul>
<li>MFC封装了Windows对象形成一个个C++对象</li>
<li>消息映射完成了这些C++对象与Windows消息的对应关系，形成了成员函数</li>
<li>程序员只需要关注业务逻辑，把这些逻辑编码到这些成员函数，完成业务系统</li>
</ul>
<h3 id="MFC对象与资源绑定">MFC对象与资源绑定</h3>
<p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/u=1779600390,3709835931&amp;fm=253&amp;app=138&amp;f=JPEG.jpeg" alt="img"></p>
<p>MFC的入门困境之一就是App Wizard：App Wizard实际上就是帮我们写代码的工具</p>
<p>我们通过win32api手工和App Wizard分别实现一个对话框的例子，来理解MFC的生成方式</p>
<details class="folding-tag" ><summary> win32api和MFC两种方式实现一个对话框 </summary>
              <div class='content'>
              <blockquote><p>项目为02MFCDlg,项目中两个文件：mfc.h和02MFCDlg.cpp，内容复用项目01FirstMFC的mfc.h和01First.cpp</p></blockquote><p>新建资源一个对话框，在属性中将ID修改为IDD_DLGDEMO</p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211107154930416.png" alt="image-20211107154930416" style="zoom:50%;" /><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">windows api方式建立对话框：</button></li><li class="tab"><button type="button" data-href="#test4-2">MFC方式</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><p>02MyDlg.cpp文件</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;mfc.h&quot;</span><br><span class="line"><span class="addition">+ #include &quot;resource.h&quot;</span></span><br><span class="line"></span><br><span class="line">BEGIN_MESSAGE_MAP(MainWindow,CFrameWnd)</span><br><span class="line">	ON_BN_CLICKED(10002,HandleButton)//ID号和成员函数</span><br><span class="line">END_MESSAGE_MAP()</span><br><span class="line"></span><br><span class="line">void MainWindow::HandleButton()</span><br><span class="line">&#123;</span><br><span class="line">	//::MessageBox(NULL, TEXT(&quot;Hello&quot;), TEXT(&quot;MFC&quot;), MB_OK);</span><br><span class="line"><span class="addition">+	::DialogBoxParam(</span></span><br><span class="line"><span class="addition">+		AfxGetInstanceHandle(),</span></span><br><span class="line"><span class="addition">+		(LPCTSTR)IDD_DLGDEMO,</span></span><br><span class="line"><span class="addition">+		NULL,</span></span><br><span class="line"><span class="addition">+		NULL,</span></span><br><span class="line"><span class="addition">+		NULL</span></span><br><span class="line"><span class="addition">+	);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MyFirstApp theApp;</span><br><span class="line"></span><br><span class="line">BOOL MyFirstApp::InitInstance()</span><br><span class="line">&#123;</span><br><span class="line">	//1.创建一个框架窗口类对象</span><br><span class="line">	MainWindow* pMain = new MainWindow();//调用上面定义的方法</span><br><span class="line">	//2.显示窗口</span><br><span class="line">	pMain-&gt;ShowWindow(m_nCmdShow);</span><br><span class="line">	//3.更新窗口</span><br><span class="line">	pMain-&gt;UpdateWindow();</span><br><span class="line">	//4.保存框架类对象的指针</span><br><span class="line">	this-&gt;m_pMainWnd = pMain;//建立Window对象和App对象的关联关系</span><br><span class="line"></span><br><span class="line">	return TRUE;//初始化正常则返回TRUE</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MainWindow::MainWindow()</span><br><span class="line">&#123;</span><br><span class="line">	Create(NULL, TEXT(&quot;我的第一个MFC程序&quot;));</span><br><span class="line"></span><br><span class="line">	//通过windows api创建一个按钮</span><br><span class="line">	HWND hBtn = ::CreateWindow(TEXT(&quot;Button&quot;),</span><br><span class="line">		TEXT(&quot;按钮&quot;),</span><br><span class="line">		WS_VISIBLE | WS_CHILD | BS_PUSHBUTTON,</span><br><span class="line">		150, 45,</span><br><span class="line">		160, 65,</span><br><span class="line">		this-&gt;m_hWnd,</span><br><span class="line">		(HMENU)10001,</span><br><span class="line">		AfxGetInstanceHandle(),</span><br><span class="line">		NULL);</span><br><span class="line"></span><br><span class="line">	CRect r(300, 450, 500, 600);</span><br><span class="line">	pBtn = new CButton();</span><br><span class="line">	pBtn-&gt;Create(TEXT(&quot;CButton&quot;),</span><br><span class="line">		WS_CHILD | WS_VISIBLE | BS_PUSHBUTTON,</span><br><span class="line">		r,</span><br><span class="line">		this,</span><br><span class="line">		10002);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><p>点击按钮弹出对话框</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211029103646063.png" alt="image-20211029103646063"></p><p>但点击关闭无法关闭对话框</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><p>右键-&gt;添加类</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211029175235730.png" alt="image-20211029175235730"></p><p>输入类名位CMyDlg，.h文件和.cpp文件两个框会随输入的类名变化</p><p>这里基类选择CDialog</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211107155547017.png" alt="image-20211107155547017"></p><p>点完成后会自动生成stdafx.h、MyDlg.h、MyDlg.cpp</p><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">stdafx.h</button></li><li class="tab"><button type="button" data-href="#test4-2">MyDlg.h</button></li><li class="tab"><button type="button" data-href="#test4-3">MyDlg.cpp</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;afxwin.h&gt;</span></span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// CMyDlg 对话框</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CMyDlg</span> :</span> <span class="keyword">public</span> CDialog</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">DECLARE_DYNAMIC</span>(CMyDlg)</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">CMyDlg</span>(CWnd* pParent = <span class="literal">NULL</span>);   <span class="comment">// 标准构造函数</span></span><br><span class="line">	<span class="keyword">virtual</span> ~<span class="built_in">CMyDlg</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对话框数据</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> AFX_DESIGN_TIME</span></span><br><span class="line">	<span class="class"><span class="keyword">enum</span> &#123;</span> IDD = IDD_DLGDEMO &#125;;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">DoDataExchange</span><span class="params">(CDataExchange* pDX)</span></span>;    <span class="comment">// DDX/DDV 支持</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">DECLARE_MESSAGE_MAP</span>()</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-3"><p>在这个cpp中引用resourse.h这个头文件，因为用到了IDD_DLGDEMO</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">// MyDlg.cpp : 实现文件</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">#include &quot;stdafx.h&quot;</span><br><span class="line">#include &quot;MyDlg.h&quot;</span><br><span class="line">#include &quot;afxdialogex.h&quot;</span><br><span class="line"><span class="addition">+ #include &quot;resource.h&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// CMyDlg 对话框</span><br><span class="line"></span><br><span class="line">IMPLEMENT_DYNAMIC(CMyDlg, CDialog)</span><br><span class="line"></span><br><span class="line">CMyDlg::CMyDlg(CWnd* pParent /*=NULL*/)</span><br><span class="line">	: CDialog(IDD_DLGDEMO, pParent)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CMyDlg::~CMyDlg()</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void CMyDlg::DoDataExchange(CDataExchange* pDX)</span><br><span class="line">&#123;</span><br><span class="line">	CDialog::DoDataExchange(pDX);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BEGIN_MESSAGE_MAP(CMyDlg, CDialog)</span><br><span class="line">END_MESSAGE_MAP()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// CMyDlg 消息处理程序</span><br><span class="line"></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>在02MFCDlg.cpp中引用头文件MyDlg.h，再写两行代码</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;mfc.h&quot;</span><br><span class="line">#include &quot;resource.h&quot;</span><br><span class="line"><span class="addition">+ #include &quot;MyDlg.h&quot;</span></span><br><span class="line"></span><br><span class="line">BEGIN_MESSAGE_MAP(MainWindow,CFrameWnd)</span><br><span class="line">	ON_BN_CLICKED(10002,HandleButton)//ID号和成员函数</span><br><span class="line">END_MESSAGE_MAP()</span><br><span class="line"></span><br><span class="line">void MainWindow::HandleButton()</span><br><span class="line">&#123;</span><br><span class="line">	//::MessageBox(NULL, TEXT(&quot;Hello&quot;), TEXT(&quot;MFC&quot;), MB_OK);</span><br><span class="line">	//::DialogBoxParam(</span><br><span class="line">	//	AfxGetInstanceHandle(),</span><br><span class="line">	//	(LPCTSTR)IDD_DLGDEMO,</span><br><span class="line">	//	NULL,</span><br><span class="line">	//	NULL,</span><br><span class="line">	//	NULL</span><br><span class="line">	//	);</span><br><span class="line"><span class="addition">+	CMyDlg dlg;</span></span><br><span class="line"><span class="addition">+	dlg.DoModal();</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MyFirstApp theApp;</span><br><span class="line"></span><br><span class="line">BOOL MyFirstApp::InitInstance()</span><br><span class="line">&#123;</span><br><span class="line">	//1.创建一个框架窗口类对象</span><br><span class="line">	MainWindow* pMain = new MainWindow();//调用上面定义的方法</span><br><span class="line">										 //2.显示窗口</span><br><span class="line">	pMain-&gt;ShowWindow(m_nCmdShow);</span><br><span class="line">	//3.更新窗口</span><br><span class="line">	pMain-&gt;UpdateWindow();</span><br><span class="line">	//4.保存框架类对象的指针</span><br><span class="line">	this-&gt;m_pMainWnd = pMain;//建立Window对象和App对象的关联关系</span><br><span class="line"></span><br><span class="line">	return TRUE;//初始化正常则返回TRUE</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MainWindow::MainWindow()</span><br><span class="line">&#123;</span><br><span class="line">	Create(NULL, TEXT(&quot;我的第一个MFC程序&quot;));</span><br><span class="line"></span><br><span class="line">	//通过windows api创建一个按钮</span><br><span class="line">	HWND hBtn = ::CreateWindow(TEXT(&quot;Button&quot;),</span><br><span class="line">		TEXT(&quot;按钮&quot;),</span><br><span class="line">		WS_VISIBLE | WS_CHILD | BS_PUSHBUTTON,</span><br><span class="line">		150, 45,</span><br><span class="line">		160, 65,</span><br><span class="line">		this-&gt;m_hWnd,</span><br><span class="line">		(HMENU)10001,</span><br><span class="line">		AfxGetInstanceHandle(),</span><br><span class="line">		NULL);</span><br><span class="line"></span><br><span class="line">	CRect r(300, 450, 500, 600);</span><br><span class="line">	pBtn = new CButton();</span><br><span class="line">	pBtn-&gt;Create(TEXT(&quot;CButton&quot;),</span><br><span class="line">		WS_CHILD | WS_VISIBLE | BS_PUSHBUTTON,</span><br><span class="line">		r,</span><br><span class="line">		this,</span><br><span class="line">		10002);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211107160942085.png" alt="image-20211107160942085"></p><p>点击CButton弹出对话框，且对话框点击×能够关闭</p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>
              </div>
            </details>
<p>这里的App Wizard帮我们做了什么？</p>
<ul>
<li>App wizar帮我们用代码将Windows的资源、windows的对象封装成符合C++语法的MFC对象，简化我们编程。</li>
<li>类向导，就是把资源（rc文件中的对话框界面、控件图形）生成.h，.cpp文件中的特定的C++对象。我们可以直接以C++语法进行操作，完成用户与应用程序的交互。</li>
</ul>
<h3 id="App-Wizard添加成员变量功能演示与剖析">App Wizard添加成员变量功能演示与剖析</h3>
<details class="folding-tag" ><summary> 例子 </summary>
              <div class='content'>
              <p>向对话框添加一个button按钮</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108104828336.png" alt="image-20211108104828336"></p><p>选中按钮，右键-&gt;添加变量</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108104951547.png" alt="image-20211108104951547"></p><p>变量名这里起为：m_btn_OK</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108105142008.png" alt="image-20211108105142008"></p><p>点击完成后，我们看到MyDlg.h、MyDlg.cpp内容发生了修改</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108105526820.png" alt="image-20211108105526820"></p><details class="folding-tag" ><summary> 具体内容的变化 </summary>              <div class='content'>              <div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">MyDlg.h</button></li><li class="tab"><button type="button" data-href="#test4-2">MyDlg.cpp</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#pragma once</span><br><span class="line">#include &quot;afxwin.h&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// CMyDlg 对话框</span><br><span class="line"></span><br><span class="line">class CMyDlg : public CDialog</span><br><span class="line">&#123;</span><br><span class="line">	DECLARE_DYNAMIC(CMyDlg)</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line">	CMyDlg(CWnd* pParent = NULL);   // 标准构造函数</span><br><span class="line">	virtual ~CMyDlg();</span><br><span class="line"></span><br><span class="line">// 对话框数据</span><br><span class="line">#ifdef AFX_DESIGN_TIME</span><br><span class="line">	enum &#123; IDD = IDD_DLGDEMO &#125;;</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">protected:</span><br><span class="line">	virtual void DoDataExchange(CDataExchange* pDX);    // DDX/DDV 支持</span><br><span class="line"></span><br><span class="line">	DECLARE_MESSAGE_MAP()</span><br><span class="line"><span class="addition">+ public:</span></span><br><span class="line"><span class="addition">+	CButton m_btn_OK;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">// MyDlg.cpp : 实现文件</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">#include &quot;stdafx.h&quot;</span><br><span class="line">#include &quot;MyDlg.h&quot;</span><br><span class="line">#include &quot;afxdialogex.h&quot;</span><br><span class="line">#include &quot;resource.h&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// CMyDlg 对话框</span><br><span class="line"></span><br><span class="line">IMPLEMENT_DYNAMIC(CMyDlg, CDialog)</span><br><span class="line"></span><br><span class="line">CMyDlg::CMyDlg(CWnd* pParent /*=NULL*/)</span><br><span class="line">	: CDialog(IDD_DLGDEMO, pParent)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CMyDlg::~CMyDlg()</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void CMyDlg::DoDataExchange(CDataExchange* pDX)</span><br><span class="line">&#123;</span><br><span class="line">	CDialog::DoDataExchange(pDX);</span><br><span class="line"><span class="addition">+	DDX_Control(pDX, IDC_BUTTON1, m_btn_OK);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BEGIN_MESSAGE_MAP(CMyDlg, CDialog)</span><br><span class="line">END_MESSAGE_MAP()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// CMyDlg 消息处理程序</span><br><span class="line"></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>              </div>            </details><p>选中按钮，在属性-&gt;控件事件中可以看到关于按钮的控件事件。我们展开BN_CLICKED，添加OnBnClickedButton成员函数</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108110507011.png" alt="image-20211108110507011"></p><p>MyDlg.h、MyDlg.cpp内容发生了改变，具体为：</p><details class="folding-tag" ><summary> 具体内容的变化 </summary>              <div class='content'>              <div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">MyDlg.h</button></li><li class="tab"><button type="button" data-href="#test4-2">MyDlg.cpp</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#pragma once</span><br><span class="line">#include &quot;afxwin.h&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// CMyDlg 对话框</span><br><span class="line"></span><br><span class="line">class CMyDlg : public CDialog</span><br><span class="line">&#123;</span><br><span class="line">	DECLARE_DYNAMIC(CMyDlg)</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line">	CMyDlg(CWnd* pParent = NULL);   // 标准构造函数</span><br><span class="line">	virtual ~CMyDlg();</span><br><span class="line"></span><br><span class="line">// 对话框数据</span><br><span class="line">#ifdef AFX_DESIGN_TIME</span><br><span class="line">	enum &#123; IDD = IDD_DLGDEMO &#125;;</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">protected:</span><br><span class="line">	virtual void DoDataExchange(CDataExchange* pDX);    // DDX/DDV 支持</span><br><span class="line"></span><br><span class="line">	DECLARE_MESSAGE_MAP()</span><br><span class="line">public:</span><br><span class="line">	CButton m_btn_OK;</span><br><span class="line"><span class="addition">+	afx_msg void OnBnClickedButton1();</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">// MyDlg.cpp : 实现文件</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">#include &quot;stdafx.h&quot;</span><br><span class="line">#include &quot;MyDlg.h&quot;</span><br><span class="line">#include &quot;afxdialogex.h&quot;</span><br><span class="line">#include &quot;resource.h&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// CMyDlg 对话框</span><br><span class="line"></span><br><span class="line">IMPLEMENT_DYNAMIC(CMyDlg, CDialog)</span><br><span class="line"></span><br><span class="line">CMyDlg::CMyDlg(CWnd* pParent /*=NULL*/)</span><br><span class="line">	: CDialog(IDD_DLGDEMO, pParent)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CMyDlg::~CMyDlg()</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void CMyDlg::DoDataExchange(CDataExchange* pDX)</span><br><span class="line">&#123;</span><br><span class="line">	CDialog::DoDataExchange(pDX);</span><br><span class="line">	DDX_Control(pDX, IDC_BUTTON1, m_btn_OK);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="addition">+ BEGIN_MESSAGE_MAP(CMyDlg, CDialog)</span></span><br><span class="line"><span class="addition">+	ON_BN_CLICKED(IDC_BUTTON1, &amp;CMyDlg::OnBnClickedButton1)</span></span><br><span class="line"><span class="addition">+ END_MESSAGE_MAP()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// CMyDlg 消息处理程序</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="addition">+ void CMyDlg::OnBnClickedButton1()</span></span><br><span class="line"><span class="addition">+ &#123;</span></span><br><span class="line"><span class="addition">+ 	// TODO: 在此添加控件通知处理程序代码</span></span><br><span class="line"><span class="addition">+ &#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>              </div>            </details><p>这里向MyDlg.cpp中的OnBnClickedButton1()添加控件通知处理程序代码，为：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CMyDlg::OnBnClickedButton1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	::<span class="built_in">MessageBox</span>(<span class="literal">NULL</span>, <span class="built_in">TEXT</span>(<span class="string">&quot;Hello&quot;</span>), <span class="built_in">TEXT</span>(<span class="string">&quot;CMyDlg的Button&quot;</span>), MB_OK);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&gt; 运行结果：</p><p>点击Button1按钮弹出对话框</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108111556825.png" alt="image-20211108111556825"></p>
              </div>
            </details>
<p>小结：</p>
<p>添加成员变量向导，是将控件（比如按钮）作为成员变量添加到对话框这个类里</p>
<p>(控件也是窗体，子窗体在父窗体里；对应C++语法就是类中的成员变量)</p>
<h3 id="App-Wizard值类型与控件类型">App Wizard值类型与控件类型</h3>
<p>添加成员变量向导中的类别有Control和Value两种，啥区别？</p>
<details class="folding-tag" ><summary> 例子：点击按钮，会修改文本框中的文本 </summary>
              <div class='content'>
              <p>向对话框添加文本框</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108112753083.png" alt="image-20211108112753083"></p><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">不使用添加成员变量的方式，用传统win api的方式</button></li><li class="tab"><button type="button" data-href="#test4-2">使用添加变量的方式</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><p>使用传统Windows api的方式，拿句柄</p><p>将MyDlg.cpp的OnBnClickedButton1()函数内容修改为：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CMyDlg::OnBnClickedButton1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	<span class="comment">//::MessageBox(NULL, TEXT(&quot;Hello&quot;), TEXT(&quot;CMyDlg的Button&quot;), MB_OK);</span></span><br><span class="line"></span><br><span class="line">	HWND hEdit = ::<span class="built_in">GetDlgItem</span>(<span class="keyword">this</span>-&gt;m_hWnd, IDC_EDIT1);<span class="comment">//this-&gt;m_hWnd：MFC当前对象的句柄</span></span><br><span class="line">	::<span class="built_in">SetWindowText</span>(hEdit, <span class="built_in">TEXT</span>(<span class="string">&quot;我是Edit&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&gt; 运行结果：</p><p>按下按钮后文本框内容被修改</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108114048302.png" alt="image-20211108114048302"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">控件类型</button></li><li class="tab"><button type="button" data-href="#test4-2">值类型</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><p>对文本框添加变量，变量名这里起为:m_edit_ct1，类别选为Control</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108114254529.png" alt="image-20211108114254529"></p><p>MyDlg.h、MyDlg.cpp的内容发生了变化，具体变化为：</p><details class="folding-tag" ><summary> 具体内容的变化 </summary>              <div class='content'>              <div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">MyDlg.h</button></li><li class="tab"><button type="button" data-href="#test4-2">MyDlg.cpp</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#pragma once</span><br><span class="line">#include &quot;afxwin.h&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// CMyDlg 对话框</span><br><span class="line"></span><br><span class="line">class CMyDlg : public CDialog</span><br><span class="line">&#123;</span><br><span class="line">	DECLARE_DYNAMIC(CMyDlg)</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line">	CMyDlg(CWnd* pParent = NULL);   // 标准构造函数</span><br><span class="line">	virtual ~CMyDlg();</span><br><span class="line"></span><br><span class="line">// 对话框数据</span><br><span class="line">#ifdef AFX_DESIGN_TIME</span><br><span class="line">	enum &#123; IDD = IDD_DLGDEMO &#125;;</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">protected:</span><br><span class="line">	virtual void DoDataExchange(CDataExchange* pDX);    // DDX/DDV 支持</span><br><span class="line"></span><br><span class="line">	DECLARE_MESSAGE_MAP()</span><br><span class="line">public:</span><br><span class="line">	CButton m_btn_OK;</span><br><span class="line">	afx_msg void OnBnClickedButton1();</span><br><span class="line"><span class="addition">+	CEdit m_edit_ct1;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">// MyDlg.cpp : 实现文件</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">#include &quot;stdafx.h&quot;</span><br><span class="line">#include &quot;MyDlg.h&quot;</span><br><span class="line">#include &quot;afxdialogex.h&quot;</span><br><span class="line">#include &quot;resource.h&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// CMyDlg 对话框</span><br><span class="line"></span><br><span class="line">IMPLEMENT_DYNAMIC(CMyDlg, CDialog)</span><br><span class="line"></span><br><span class="line">CMyDlg::CMyDlg(CWnd* pParent /*=NULL*/)</span><br><span class="line">	: CDialog(IDD_DLGDEMO, pParent)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CMyDlg::~CMyDlg()</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void CMyDlg::DoDataExchange(CDataExchange* pDX)</span><br><span class="line">&#123;</span><br><span class="line">	CDialog::DoDataExchange(pDX);</span><br><span class="line">	DDX_Control(pDX, IDC_BUTTON1, m_btn_OK);</span><br><span class="line"><span class="addition">+	DDX_Control(pDX, IDC_EDIT1, m_edit_ct1);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BEGIN_MESSAGE_MAP(CMyDlg, CDialog)</span><br><span class="line">	ON_BN_CLICKED(IDC_BUTTON1, &amp;CMyDlg::OnBnClickedButton1)</span><br><span class="line">END_MESSAGE_MAP()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// CMyDlg 消息处理程序</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void CMyDlg::OnBnClickedButton1()</span><br><span class="line">&#123;</span><br><span class="line">	// TODO: 在此添加控件通知处理程序代码</span><br><span class="line">	//::MessageBox(NULL, TEXT(&quot;Hello&quot;), TEXT(&quot;CMyDlg的Button&quot;), MB_OK);</span><br><span class="line"></span><br><span class="line">	HWND hEdit = ::GetDlgItem(this-&gt;m_hWnd, IDC_EDIT1);//this-&gt;m_hWnd：MFC当前对象的句柄</span><br><span class="line">	::SetWindowText(hEdit, TEXT(&quot;我是Edit&quot;));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>              </div>            </details><p>在MyDlg.cpp的OnBnClickedButton1()函数中使用对象m_edit_ct1,可以看到这个对象里已封装了很多的方法供程序员调用</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108165436693.png" alt="image-20211108165436693"></p><p>修改OnBnClickedButton1()函数为</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CMyDlg::OnBnClickedButton1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	<span class="comment">//::MessageBox(NULL, TEXT(&quot;Hello&quot;), TEXT(&quot;CMyDlg的Button&quot;), MB_OK);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//HWND hEdit = ::GetDlgItem(this-&gt;m_hWnd, IDC_EDIT1);//this-&gt;m_hWnd：MFC当前对象的句柄</span></span><br><span class="line">	<span class="comment">//::SetWindowText(hEdit, TEXT(&quot;我是Edit&quot;));</span></span><br><span class="line"></span><br><span class="line">	m_edit_ct1.<span class="built_in">SetWindowTextW</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;Control类型改的！&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&gt; 运行结果（运行前我把文本框拉长了，要不显示不全）：</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108165940141.png" alt="image-20211108165940141"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><p>对文本框添加变量，由于先前添加过Control类别，不能再添加Control类别</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108170209157.png" alt="image-20211108170209157"></p><p>我们添加Value类别，可以看到变量类型（自动）显示CSstring，变量名这里我们起为m_edit_cs</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108170233964.png" alt="image-20211108170233964"></p><p>MyDlg.h、MyDlg.cpp的内容发生了变化，具体变化为：</p><details class="folding-tag" ><summary> 具体内容的变化 </summary>              <div class='content'>              <div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">MyDlg.h</button></li><li class="tab"><button type="button" data-href="#test4-2">MyDlg.cpp</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#pragma once</span><br><span class="line">#include &quot;afxwin.h&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// CMyDlg 对话框</span><br><span class="line"></span><br><span class="line">class CMyDlg : public CDialog</span><br><span class="line">&#123;</span><br><span class="line">	DECLARE_DYNAMIC(CMyDlg)</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line">	CMyDlg(CWnd* pParent = NULL);   // 标准构造函数</span><br><span class="line">	virtual ~CMyDlg();</span><br><span class="line"></span><br><span class="line">// 对话框数据</span><br><span class="line">#ifdef AFX_DESIGN_TIME</span><br><span class="line">	enum &#123; IDD = IDD_DLGDEMO &#125;;</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">protected:</span><br><span class="line">	virtual void DoDataExchange(CDataExchange* pDX);    // DDX/DDV 支持</span><br><span class="line"></span><br><span class="line">	DECLARE_MESSAGE_MAP()</span><br><span class="line">public:</span><br><span class="line">	CButton m_btn_OK;</span><br><span class="line">	afx_msg void OnBnClickedButton1();</span><br><span class="line">	CEdit m_edit_ct1;</span><br><span class="line"><span class="addition">+	CString m_edit_cs;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">// MyDlg.cpp : 实现文件</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">#include &quot;stdafx.h&quot;</span><br><span class="line">#include &quot;MyDlg.h&quot;</span><br><span class="line">#include &quot;afxdialogex.h&quot;</span><br><span class="line">#include &quot;resource.h&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// CMyDlg 对话框</span><br><span class="line"></span><br><span class="line">IMPLEMENT_DYNAMIC(CMyDlg, CDialog)</span><br><span class="line"></span><br><span class="line">CMyDlg::CMyDlg(CWnd* pParent /*=NULL*/)</span><br><span class="line">	: CDialog(IDD_DLGDEMO, pParent)</span><br><span class="line">	, m_edit_cs(_T(&quot;&quot;))</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CMyDlg::~CMyDlg()</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void CMyDlg::DoDataExchange(CDataExchange* pDX)</span><br><span class="line">&#123;</span><br><span class="line">	CDialog::DoDataExchange(pDX);</span><br><span class="line">	DDX_Control(pDX, IDC_BUTTON1, m_btn_OK);</span><br><span class="line">	DDX_Control(pDX, IDC_EDIT1, m_edit_ct1);</span><br><span class="line"><span class="addition">+	DDX_Text(pDX, IDC_EDIT1, m_edit_cs);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">BEGIN_MESSAGE_MAP(CMyDlg, CDialog)</span><br><span class="line">	ON_BN_CLICKED(IDC_BUTTON1, &amp;CMyDlg::OnBnClickedButton1)</span><br><span class="line">END_MESSAGE_MAP()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// CMyDlg 消息处理程序</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void CMyDlg::OnBnClickedButton1()</span><br><span class="line">&#123;</span><br><span class="line">	// TODO: 在此添加控件通知处理程序代码</span><br><span class="line">	//::MessageBox(NULL, TEXT(&quot;Hello&quot;), TEXT(&quot;CMyDlg的Button&quot;), MB_OK);</span><br><span class="line"></span><br><span class="line">	//HWND hEdit = ::GetDlgItem(this-&gt;m_hWnd, IDC_EDIT1);//this-&gt;m_hWnd：MFC当前对象的句柄</span><br><span class="line">	//::SetWindowText(hEdit, TEXT(&quot;我是Edit&quot;));</span><br><span class="line"></span><br><span class="line">	m_edit_ct1.SetWindowTextW(TEXT(&quot;Control类型改的！&quot;));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>              </div>            </details><p>修改OnBnClickedButton1()函数为</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CMyDlg::OnBnClickedButton1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	<span class="comment">//::MessageBox(NULL, TEXT(&quot;Hello&quot;), TEXT(&quot;CMyDlg的Button&quot;), MB_OK);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//HWND hEdit = ::GetDlgItem(this-&gt;m_hWnd, IDC_EDIT1);//this-&gt;m_hWnd：MFC当前对象的句柄</span></span><br><span class="line">	<span class="comment">//::SetWindowText(hEdit, TEXT(&quot;我是Edit&quot;));</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//m_edit_ct1.SetWindowTextW(TEXT(&quot;Control类型改的！&quot;));</span></span><br><span class="line"></span><br><span class="line">	m_edit_cs = <span class="built_in">TEXT</span>(<span class="string">&quot;我是CS类型的CEdit！&quot;</span>);</span><br><span class="line">	<span class="built_in">UpdateData</span>(FALSE);<span class="comment">//上一句只是改了内容，没这一句，不会显示在文本框中</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&gt; 运行结果：</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108171306054.png" alt="image-20211108171306054"></p><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>
              </div>
            </details>
<p>小结：</p>
<p>所谓App Wizard就是一种让我们可以用C++的语法，操作这些对象的机制</p>
<p>只要我们查阅msdn，查阅MFC的手册，我们就可以完成逻辑业务的开发</p>
<h3 id="对话框应用程序程序设计">对话框应用程序程序设计</h3>
<ul>
<li>以对话框应用程序设计为例，熟悉MFC开发环境，提高定制MFC开发的能力</li>
</ul>
<details class="folding-tag" ><summary> 创建MFC项目03MFCCheckboxDemo，基于对话框 </summary>
              <div class='content'>
              <p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108173901400.png" alt="image-20211108173901400"></p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108173919424.png" alt="image-20211108173919424"></p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108174007226.png" alt="image-20211108174007226"></p><p>保持默认，下一步</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108174034447.png" alt="image-20211108174034447"></p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108174045530.png" alt="image-20211108174045530"></p><p>点击完成</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108174140449.png" alt="image-20211108174140449"></p><details class="folding-tag" ><summary> 题外话 </summary>              <div class='content'>              <p>（题外话：CMy03MFCCheckboxDemoApp是进程实例，CMy03MFCCheckboxDemoDlg是我们画出来的窗口）</p>              </div>            </details>
              </div>
            </details>
<details class="folding-tag" ><summary> 观察体会下自动生成的文件 </summary>
              <div class='content'>
              <p>右边的文件都是自动生成的</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108200808483.png" alt="image-20211108200808483"></p><p>运行一下：</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108201017683.png" alt="image-20211108201017683"></p><p>查看下资源视图</p><p>有个aboutbox资源、对话框资源</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108201129888.png" alt="image-20211108201129888"></p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108201224517.png" alt="image-20211108201224517"></p><p>在类视图中双击CAboutDlg，转到定义处</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span>&#123;</span>IDD=IDD_ABOUTBOX&#125;;</span><br></pre></td></tr></table></figure><p>上面这句代码完成aboutbox资源与C++对象的绑定</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108201403404.png" alt="image-20211108201403404"></p><p>对话框的资源同理</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108201653583.png" alt="image-20211108201653583"></p>
              </div>
            </details>
<details class="folding-tag" ><summary> 例子：CheckBox置顶功能 </summary>
              <div class='content'>
              <p>向对话框添加一个Check Box，修改ID和Caption</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108202229723.png" alt="image-20211108202229723"></p><p>运行一下:</p><p>可以勾上也可以取消，只不过我们还没对勾上时进行业务逻辑开发</p> <img no-lazy class="inline" src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108202257655.png" style="height:200px;"/> <img no-lazy class="inline" src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108202307520.png" style="height:200px;"/> <p>对这个复选框添加变量：</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108202504093.png" alt="image-20211108202504093"></p><p>选中checkbox，属性窗口中选中控件事件，添加按下时的成员函数</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108202714620.png" alt="image-20211108202714620"></p><p>编写成员函数内容为：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CMy03MFCCheckboxDemoDlg::OnBnClickedChkTopmost</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	<span class="keyword">if</span> (m_chk_ct1.<span class="built_in">GetCheck</span>())<span class="comment">//被选中</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">SetWindowPos</span>(&amp;wndTopMost, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, SWP_NOMOVE | SWP_NOSIZE | SWP_NOREDRAW);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span><span class="comment">//没被选中</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//取消置顶</span></span><br><span class="line">		<span class="built_in">SetWindowPos</span>(&amp;wndNoTopMost, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, SWP_NOMOVE | SWP_NOSIZE | SWP_NOREDRAW);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&gt; 运行结果：</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108204038526.png" alt="image-20211108204038526"></p>
              </div>
            </details>
<hr>
<details class="folding-tag" ><summary> 例子：Combox控件及TRACE使用 </summary>
              <div class='content'>
              <details class="folding-tag" ><summary> 项目创建 </summary>              <div class='content'>              <p>创建MFC应用程序项目04CComboxDemo，基于对话框，去掉SDL检查</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108205003456.png" alt="image-20211108205003456"></p><p>不选系统菜单，不选“关于”框（资源中就没aboutbox了）</p>              </div>            </details><p>向对话框添加Combo Box控件，属性中Data内容为选择框条目，条目间以;分隔</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108210051055.png" alt="image-20211108210051055"></p><p>运行：</p><p>按下拉，有3个条目可选择</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108210133089.png" alt="image-20211108210133089"></p><p>向对话框添加Button按钮，对按钮添加变量</p> <img no-lazy class="inline" src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108210440139.png" style="height:180px;"/> <img no-lazy class="inline" src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108210407224.png" style="height:200px;"/> <p>对按钮添加BN_CLICKED事件的成员函数OnBnClickedButton1</p><p>一：通过按钮获取Combox的内容</p><p>将成员函数OnBnClickedButton1编写为：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CMy04CComboxDemoDlg::OnBnClickedButton1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	TCHAR ws[<span class="number">256</span>];</span><br><span class="line">	((CComboBox*)<span class="built_in">GetDlgItem</span>(IDC_COMBO1))-&gt;<span class="built_in">GetWindowTextW</span>(ws, <span class="number">256</span>);</span><br><span class="line">	<span class="comment">//GetDlgItem返回类型为CWnd，强转为CComboBox类型</span></span><br><span class="line">	<span class="built_in">TRACE</span>(<span class="string">&quot;---%S\n&quot;</span>, ws);</span><br><span class="line">	<span class="comment">//用TRACE，方便调试</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>用Messagebox可能会阻碍当前进程运行，而TRACE是在输出窗口输出，不会影响进程执行</p><p>&gt; 运行:</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108211241354.png" alt="image-20211108211241354"></p><p>输出窗口输出</p><p>二：通过按钮往Combox里添加选择条目</p><p>将成员函数OnBnClickedButton1编写为：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CMy04CComboxDemoDlg::OnBnClickedButton1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	<span class="comment">//TCHAR ws[256];</span></span><br><span class="line">	<span class="comment">//((CComboBox*)GetDlgItem(IDC_COMBO1))-&gt;GetWindowTextW(ws, 256);</span></span><br><span class="line">	<span class="comment">////GetDlgItem返回类型为CWnd，强转为CComboBox类型</span></span><br><span class="line">	<span class="comment">//TRACE(&quot;---%S\n&quot;, ws);</span></span><br><span class="line">	<span class="comment">////用TRACE，方便调试</span></span><br><span class="line"></span><br><span class="line">	CComboBox* pCmb = (CComboBox*)<span class="built_in">GetDlgItem</span>(IDC_COMBO1);</span><br><span class="line">	pCmb-&gt;<span class="built_in">AddString</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;444&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>&gt; 运行：</p><p>原本只有3个条目</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108211925406.png" alt="image-20211108211925406"></p><p>每点一次Button1，会加一条444</p> <img no-lazy class="inline" src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/F[3SF9ZK5{N1H95B2AG1O8.png" style="height:220px;"/> <img no-lazy class="inline" src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211108212113786.png" style="height:220px;"/> 
              </div>
            </details>
<hr>
<details class="folding-tag" ><summary> 例子：List Box与windows消息 </summary>
              <div class='content'>
              <blockquote><p>创建MFC应用程序项目05CListBoxDemo，基于对话框，去SDL检查，去系统菜单</p></blockquote><p>添加List Box</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211109101027916.png" alt="image-20211109101027916"></p><p>右键-&gt;类向导</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211109102139461.png" alt="image-20211109102139461"></p><p>在<kbd>消息</kbd>中选择<kbd>WM_LBUTTONDOWN</kbd>，点<kbd>添加处理程序</kbd>，会生成一个OnLButtonDown的函数，选择它点<kbd>编辑代码</kbd>会跳到这个函数体</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211109102326460.png" alt="image-20211109102326460"></p><p>编辑函数体</p><details class="folding-tag" ><summary> 加个弹窗演示一下 </summary>              <div class='content'>              <figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">void CMy05CListBoxDemoDlg::OnLButtonDown(UINT nFlags, CPoint point)</span><br><span class="line">&#123;</span><br><span class="line">	// TODO: 在此添加消息处理程序代码和/或调用默认值</span><br><span class="line"><span class="addition">+	AfxMessageBox(TEXT(&quot;Hello Test&quot;));</span></span><br><span class="line">	CDialogEx::OnLButtonDown(nFlags, point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行：</p><p>在客户区一些区域按下鼠标左键会弹窗（后边会提事件冒泡）</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211109103206124.png" alt="image-20211109103206124"></p>              </div>            </details><details class="folding-tag" ><summary> 每次按下鼠标左键往List Box里添加文本 </summary>              <div class='content'>              <p>修改函数体为</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CMy05CListBoxDemoDlg::OnLButtonDown</span><span class="params">(UINT nFlags, CPoint point)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加消息处理程序代码和/或调用默认值</span></span><br><span class="line">	<span class="comment">//AfxMessageBox(TEXT(&quot;Hello Test&quot;));</span></span><br><span class="line"></span><br><span class="line">	CListBox* pList = (CListBox*)<span class="built_in">GetDlgItem</span>(IDC_LIST1);</span><br><span class="line">	pList-&gt;<span class="built_in">AddString</span>(<span class="built_in">TEXT</span>(<span class="string">&quot;1111&quot;</span>));</span><br><span class="line"></span><br><span class="line">	CDialogEx::<span class="built_in">OnLButtonDown</span>(nFlags, point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>同时要在这个文件前边#include “resource.h”</p><p>运行：</p><p><img no-lazy class="inline" src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211109103959866.png" style="height:180px;"/> <img no-lazy class="inline" src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211109104010216.png" style="height:180px;"/> <img no-lazy class="inline" src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211109104024209.png" style="height:180px;"/></p>              </div>            </details>
              </div>
            </details>
<details class="folding-tag" ><summary> 小综合例子：List Box、Button、Edit与事件冒泡概念 </summary>
              <div class='content'>
              <p>添加Button（修改Caption为&gt;&gt;)、Static Text</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211109105351361.png" alt="image-20211109105351361"></p><p>直接对Button按钮添加成员函数（不先添加变量也行的）</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211109105458336.png" alt="image-20211109105458336"></p><p>编写函数体为：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CMy05CListBoxDemoDlg::OnBnClickedButton1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line"></span><br><span class="line">	CListBox* pList = (CListBox*)<span class="built_in">GetDlgItem</span>(IDC_LIST1);</span><br><span class="line">	CStatic* pCs = (CStatic*)<span class="built_in">GetDlgItem</span>(IDC_STATIC);</span><br><span class="line">	WCHAR ws[<span class="number">256</span>];</span><br><span class="line">	pList-&gt;<span class="built_in">GetText</span>(pList-&gt;<span class="built_in">GetCurSel</span>(), ws);</span><br><span class="line">	pCs-&gt;<span class="built_in">SetWindowTextW</span>(ws);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行：</p><p>先鼠标按下左键往List Box里添加条目，然后按Button按钮，但List Box的条目没有显示在Static文本框中</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211109105923855.png" alt="image-20211109105923855"></p><details class="folding-tag" ><summary> 原因 </summary>              <div class='content'>              <p>下断</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211109144127945.png" alt="image-20211109144127945"></p><p>运行，添加条目后点Button按钮</p><p>点击鼠标左键确实进到了OnBnClickedButton1()函数</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211109144359366.png" alt="image-20211109144359366"></p><p>对pList-&gt;GetCurSel()添加监视</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211109144553330.png" alt="image-20211109144553330"></p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211109144615635.png" alt="image-20211109144615635"  /><p>说明没选中</p><p>点击 <img no-lazy class="inline" src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211109144813882.png" style="height:30px;"/> ，点击红色断点把断点取消<img no-lazy class="inline" src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211109144851611.png" style="height:90px;"/></p><p>这次选中条目再按Button按钮，可以了（有个小bug：1111不是跑到Static而是下方，<s>请假装没看到</s>）</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211109144933932.png" alt="image-20211109144933932"></p>              </div>            </details><details class="folding-tag" ><summary> 事件冒泡简要介绍 </summary>              <div class='content'>              <p>同样是鼠标按下左键，为何按Button（获取List Box选中的条目然后给Static设置文本）和其他区域（给List Box添加条目）有不同的效果？</p><p>答：</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211109150426958.png" alt="image-20211109150426958"></p><p>在子窗体区域按下鼠标左键，父窗体也能感知到，但这个事件被子窗体处理，父窗体就不处理了，这是MFC一个很好的封装。</p><p>如果需要由父窗体来处理这个事件，可以改。但实际应用中，都是子窗体处理，父窗体无需处理。程序员直接开发就完事，虽然可能会感到困惑。</p>              </div>            </details>
              </div>
            </details>
<h3 id="标准控件综合案例：网页管理专家">标准控件综合案例：网页管理专家</h3>
<p>需求与功能点说明：</p>
<ol>
<li>进一步巩固MFC使用C++语法封装windows窗体的概念，演示基于C++类的窗体间传值</li>
<li>使用剪贴板完成进程间通信（进一步探讨进程间内存共享的概念）</li>
<li>如何在VC中启动新进程</li>
<li>MFC中如何完成Cstring字符串分割</li>
</ol>
<p>现实意义：</p>
<p>双击条目打开网址，然后粘贴用户名，一个比较方便快捷的网页用户收藏夹</p>
<details class="folding-tag" ><summary> 资源布局 </summary>
              <div class='content'>
              <blockquote><p>MFC应用程序，项目名称为05AddrExpert，对话框，去SDL检查，去系统菜单，高级功能全去</p></blockquote><p>对默认的窗体进行调整</p><p>调整前后：</p><p><img no-lazy class="inline" src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211109155749695.png" style="height:200px;"/>  <img no-lazy class="inline" src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211109205813784.png" style="height:220px;"/></p><table><thead><tr><th>控件类型</th><th>Caption</th><th>ID</th></tr></thead><tbody><tr><td>Button</td><td>添加网址</td><td>IDC_BTNADD</td></tr><tr><td>List Box</td><td>没改</td><td>没改</td></tr></tbody></table><p>在<kbd>资源文件</kbd>添加资源-Dialog</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211109210027247.png" alt="image-20211109210027247"></p><table><thead><tr><th>控件类型</th><th>ID</th></tr></thead><tbody><tr><td>Dialog</td><td>IDD_DLGADDR</td></tr></tbody></table><p>加一些控件及修改：</p><table><thead><tr><th>控件类型</th><th>ID</th></tr></thead><tbody><tr><td>Edit Control</td><td>IDC_EDITADDR</td></tr><tr><td>Edit Control</td><td>IDC_EDITUSER</td></tr></tbody></table><table><thead><tr><th>控件类型</th><th>Caption</th></tr></thead><tbody><tr><td>Static Text</td><td>网址</td></tr><tr><td>Static Text</td><td>用户名</td></tr></tbody></table><table><thead><tr><th>控件类型</th><th>Caption</th><th>Name</th></tr></thead><tbody><tr><td>Button</td><td>确认添加</td><td>没变</td></tr></tbody></table><p>（要对这个对话框添加类，有了相应的.h、.cpp文件，才能往里添加代码，才把资源变成MFC可以识别的类）</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211109211715478.png" alt="image-20211109211715478"></p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211109211752955.png" alt="image-20211109211752955"></p>
              </div>
            </details>
<details class="folding-tag" ><summary> 添加网址和字符串切割 </summary>
              <div class='content'>
              <details class="folding-tag" ><summary> 确认添加 按钮 </summary>              <div class='content'>              <p>对<code>确认添加</code>按钮控件事件中的<code>BN_CLICKED</code>添加<code>OnBnClickedButton1</code></p><p>在<code>DlgAddr.h</code>加两个<code>CString</code>成员</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#pragma once</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// CDlgAddr 对话框</span><br><span class="line"></span><br><span class="line">class CDlgAddr : public CDialogEx</span><br><span class="line">&#123;</span><br><span class="line">	DECLARE_DYNAMIC(CDlgAddr)</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line">	CDlgAddr(CWnd* pParent = NULL);   // 标准构造函数</span><br><span class="line">	virtual ~CDlgAddr();</span><br><span class="line"></span><br><span class="line">	//add by Dingst</span><br><span class="line"><span class="addition">+	CString strAddr;</span></span><br><span class="line"><span class="addition">+	CString strUser;</span></span><br><span class="line"></span><br><span class="line">// 对话框数据</span><br><span class="line">#ifdef AFX_DESIGN_TIME</span><br><span class="line">	enum &#123; IDD = IDD_DIALOG1 &#125;;</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">protected:</span><br><span class="line">	virtual void DoDataExchange(CDataExchange* pDX);    // DDX/DDV 支持</span><br><span class="line"></span><br><span class="line">	DECLARE_MESSAGE_MAP()</span><br><span class="line">public:</span><br><span class="line">	afx_msg void OnBnClickedButton1();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>编写<code>OnBnClickedButton1</code>函数体（<code>DlgAddr.cpp</code>文件）</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CDlgAddr::OnBnClickedButton1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	<span class="built_in">GetDlgItemText</span>(IDC_EDITADDR, strAddr);</span><br><span class="line">	<span class="built_in">GetDlgItemText</span>(IDC_EDITUSER, strUser);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>              </div>            </details><details class="folding-tag" ><summary> 添加网址 按钮 </summary>              <div class='content'>              <p>对<kbd>添加网址</kbd>按钮控件事件中的<code>BN_CLICKED</code>添加<code>OnBnClickedBtnadd</code></p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211109213028529.png" alt="image-20211109213028529"></p><p>编写函数体<code>OnBnClickedBtnadd</code>（05AddrExpertDlg.cpp文件，前边<code>#include &quot;DlgAddr.h&quot;</code>：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CMy05AddrExpertDlg::OnBnClickedBtnadd</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line"></span><br><span class="line">	CDlgAddr dlg;</span><br><span class="line">	dlg.<span class="built_in">DoModal</span>();<span class="comment">//显示对话框</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//将网址和用户名内容放到List Box中</span></span><br><span class="line">	CListBox* pList = (CListBox*)(<span class="built_in">GetDlgItem</span>(IDC_LIST1));</span><br><span class="line">	pList-&gt;<span class="built_in">AddString</span>(dlg.strAddr + <span class="string">&quot;;&quot;</span> + dlg.strUser);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行：</p> <img no-lazy class="inline" src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/添加网址.gif" style="height:400px;"/>               </div>            </details><details class="folding-tag" ><summary> List Box控件 </summary>              <div class='content'>              <p>对<kbd>List Box</kbd>控件事件中的<code>LBN_DBLCLK</code>添加<code>OnLbnDblclkList1</code></p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211110103625328.png" alt="image-20211110103625328"></p><p>编写函数体<code>OnLbnDblclkList1</code>（05AddrExpertDlg.cpp文件）：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CMy05AddrExpertDlg::OnLbnDblclkList1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	CListBox* pList = ((CListBox*)<span class="built_in">GetDlgItem</span>(IDC_LIST1));</span><br><span class="line"></span><br><span class="line">	CString strTemp;</span><br><span class="line">	pList-&gt;<span class="built_in">GetText</span>(pList-&gt;<span class="built_in">GetCurSel</span>(), strTemp);<span class="comment">//pList-&gt;GetCurSel()选哪一行</span></span><br><span class="line">	<span class="comment">//我们拿到的都是形如&quot;https://mail.qq.com;123@qq.com&quot;</span></span><br><span class="line">	<span class="comment">//要对字符串进行切割，MFC有提供切割的函数</span></span><br><span class="line">	</span><br><span class="line">	CString output;</span><br><span class="line">	<span class="built_in">AfxExtractSubString</span>(output, strTemp, <span class="number">0</span>, <span class="string">&#x27;;&#x27;</span>);<span class="comment">//&#x27;;&#x27;号0个</span></span><br><span class="line">	<span class="built_in">TRACE</span>(<span class="string">&quot;0----&gt;%S&quot;</span>, output);<span class="comment">//运行看下对不对</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行：</p><p>添加网址后双击这个条目，可以看到输出窗口，切割成功</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211110104441337.png" alt="image-20211110104441337"></p>              </div>            </details>
              </div>
            </details>
<details class="folding-tag" ><summary> 打开网址 </summary>
              <div class='content'>
              <figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">void CMy05AddrExpertDlg::OnLbnDblclkList1()</span><br><span class="line">&#123;</span><br><span class="line">	// TODO: 在此添加控件通知处理程序代码</span><br><span class="line">	CListBox* pList = ((CListBox*)GetDlgItem(IDC_LIST1));</span><br><span class="line"></span><br><span class="line">	CString strTemp;</span><br><span class="line">	pList-&gt;GetText(pList-&gt;GetCurSel(), strTemp);//pList-&gt;GetCurSel()选哪一行</span><br><span class="line">	//我们拿到的都是形如&quot;https://mail.qq.com;123@qq.com&quot;</span><br><span class="line">	//要对字符串进行切割，MFC有提供切割的函数</span><br><span class="line">	</span><br><span class="line">	CString output;</span><br><span class="line">	AfxExtractSubString(output, strTemp, 0, &#x27;;&#x27;);//&#x27;;&#x27;号0个</span><br><span class="line">	TRACE(&quot;0----&gt;%S&quot;, output);//运行下在输出窗口看切割对不对</span><br><span class="line"></span><br><span class="line"><span class="addition">+	ShellExecute(NULL, TEXT(&quot;open&quot;), output, NULL, NULL, SW_SHOW);//打开网址</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行：</p><p>添加网址后，双击条目，现象：打开了浏览器进入了网址</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211110105046199.png" alt="image-20211110105046199"></p>
              </div>
            </details>
<details class="folding-tag" ><summary> 剪贴板功能 </summary>
              <div class='content'>
              <details class="folding-tag" ><summary> 参考以及拓展 </summary>              <div class='content'>              <p>剪贴板流程：</p><p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/398335345/answer/1258940042">当我们在电脑按下ctrl+c，剪切板储存了哪些信息？ - ShellBin的回答 - 知乎</a></p><p>流程图解：</p><p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/66284095/answer/240367965">电脑复制粘贴背后发生了什么？ - SuperSodaSea的回答 - 知乎</a></p><p>MSDN：</p><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/windows/win32/dataxchg/clipboard?redirectedfrom=MSDN">剪贴板</a></p>              </div>            </details><p>Windows系统里，剪贴板(clipboard)功能，可以在不同的进程里进行数据交换，也就是说两个进程上是可以共享数据，要实现这样的功能，Windows系统提供了API函数GlobalAlloc来分配全局内存，可以让不同的进程实现数据共享。</p><ol><li>打开并清空剪贴板<br><code>OpenClipboard &amp; EmptyClipboard</code></li><li>分配全局内存<br><code>GlobalAlloc</code></li><li>向全局内存放入想要拷贝的内容<br><code>SetClipboardData</code></li><li>把内容送到剪贴板<br><code>CloseClipboard</code></li><li>关闭剪贴板，以使其他程序可以访问，释放掉全局内存<br><code>GlobalFree</code></li></ol><p>继续编写函数体<code>OnLbnDblclkList1</code>（05AddrExpertDlg.cpp文件）：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CMy05AddrExpertDlg::OnLbnDblclkList1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加控件通知处理程序代码</span></span><br><span class="line">	CListBox* pList = ((CListBox*)<span class="built_in">GetDlgItem</span>(IDC_LIST1));</span><br><span class="line"></span><br><span class="line">	CString strTemp;</span><br><span class="line">	pList-&gt;<span class="built_in">GetText</span>(pList-&gt;<span class="built_in">GetCurSel</span>(), strTemp);<span class="comment">//pList-&gt;GetCurSel()选哪一行</span></span><br><span class="line">	<span class="comment">//我们拿到的都是形如&quot;https://mail.qq.com;123@qq.com&quot;</span></span><br><span class="line">	<span class="comment">//要对字符串进行切割，MFC有提供切割的函数</span></span><br><span class="line">	</span><br><span class="line">	CString output;</span><br><span class="line">	<span class="built_in">AfxExtractSubString</span>(output, strTemp, <span class="number">0</span>, <span class="string">&#x27;;&#x27;</span>);<span class="comment">//&#x27;;&#x27;号0个</span></span><br><span class="line">	<span class="built_in">TRACE</span>(<span class="string">&quot;0----&gt;%S&quot;</span>, output);<span class="comment">//运行下在输出窗口看切割对不对</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">ShellExecute</span>(<span class="literal">NULL</span>, <span class="built_in">TEXT</span>(<span class="string">&quot;open&quot;</span>), output, <span class="literal">NULL</span>, <span class="literal">NULL</span>, SW_SHOW);<span class="comment">//打开网址</span></span><br><span class="line">	<span class="comment">/*-------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line">	<span class="built_in">AfxExtractSubString</span>(output, strTemp, <span class="number">1</span>, <span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">	HGLOBAL p = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">OpenClipboard</span>())<span class="comment">//剪贴板没被其他进程占用，能打开</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">EmptyClipboard</span>();<span class="comment">//清空剪切板</span></span><br><span class="line">		USES_CONVERSION;<span class="comment">//这个宏会告诉编译器，在紧接的代码中我们要用OLE库中代码(如ansi到unicode的A2W(...))的转换宏</span></span><br><span class="line">		<span class="comment">//MFC是Unicode或多字节</span></span><br><span class="line">		<span class="keyword">char</span> szName[<span class="number">256</span>];</span><br><span class="line">		<span class="built_in">strcpy</span>(szName, <span class="built_in">T2A</span>(output));<span class="comment">//T2A，Unicode/多字节转char数组</span></span><br><span class="line"></span><br><span class="line">		HGLOBAL hMem = <span class="built_in">GlobalAlloc</span>(GHND, <span class="built_in"><span class="keyword">sizeof</span></span>(szName));<span class="comment">//分配全局内存</span></span><br><span class="line">		<span class="keyword">char</span>* pmem = (<span class="keyword">char</span>*)<span class="built_in">GlobalLock</span>(hMem);<span class="comment">//锁定全局内存</span></span><br><span class="line">		<span class="built_in">memcpy</span>(pmem, szName, <span class="built_in"><span class="keyword">sizeof</span></span>(szName));<span class="comment">//向全局内存放入内容</span></span><br><span class="line">		<span class="built_in">SetClipboardData</span>(CF_TEXT, hMem);<span class="comment">//把内容送到剪贴板</span></span><br><span class="line">		<span class="built_in">CloseClipboard</span>();<span class="comment">//关闭剪贴板，以使其他程序可以访问</span></span><br><span class="line">		p = <span class="built_in">GlobalFree</span>(hMem);<span class="comment">//释放全局内存</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行：</p><p>添加网址https://mail.qq.com，用户名123@qq.com。双击条目后浏览器会转到网址，剪贴板有123@qq.com</p><img no-lazy class="inline" src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/网页管理专家-剪贴板.gif" style="height:400px;"/> <details class="folding-tag" ><summary> 用户空间与内核空间 </summary>              <div class='content'>              <p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/ai616818/archive/2012/04/18/2455520.html">内核空间由所有进程共享</a></p><p>0~2G为用户空间，所有进程共享2-4G的内核空间。剪贴板本质上是内核空间的一块内存存储区。</p><p>网页管理专家这个进程按剪贴板使用的流程，在内核空间申请全局内存，放入用户名，再把这块内容送到剪贴板，释放剪贴板，释放全局内存（因为其他进程也可能会申请全局内存，如果不释放，系统空间就那么大，用完会内存泄漏）。因为内核空间共享，所以浏览器使用剪贴板时有用户名这个剪贴选项。</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211114151007350.png" alt="image-20211114151007350"></p>              </div>            </details>
              </div>
            </details>
<h3 id="MFC多线程技术">MFC多线程技术</h3>
<h4 id="MFC线程概论">MFC线程概论</h4>
<p>MFC中有两类线程，分别称为工作者线程和用户界面线程。二者的区别在于工作者线程没有消息循环，而用户界面线程有自己的消息队列和消息循环。</p>
<p>工作者线程没有消息机制，通常用来执行后台计算和维护任务，如冗长的计算过程，打印机的后台打印等。用户界面线程一般用于处理独立于其他线程之外的用户输入，响应用户及系统所产省的事件和消息等。但对于Win32的API编程而言，这两种线程是没有区别的，他们都只需要线程的启动地址即可启动线程来执行任务。</p>
<p>在MFC中，一般用于全局函数AfxBeginThread()来创建并初始化一个线程的运行，该函数有两种重载形式，分别用于创建工作者线程和用户界面线程。两种重载函数原型和参数分别说明如下：<br>
（1）工作者线程</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">CWndThread *<span class="title">AfxBeginThread</span><span class="params">(AFX_THREADPROC pfnThreadProc,</span></span></span><br><span class="line"><span class="params"><span class="function">	LPVOID pParam,</span></span></span><br><span class="line"><span class="params"><span class="function">	UINT nPriority=THREAD_PRIORITY_NORMAL,</span></span></span><br><span class="line"><span class="params"><span class="function">	UNIT nStackSize=<span class="number">0</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	DWORD dwCreateFlags=<span class="number">0</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">	LPSECURITY_ATTRIBUTES lpSecurityAttrs=<span class="literal">NULL</span>)</span></span>;</span><br></pre></td></tr></table></figure>
<p>（2）UI线程（用户界面线程）</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">CWndThread *<span class="title">AfxBeginThread</span><span class="params">(CRuntimeClass *pThreadClass)</span>,</span></span><br><span class="line"><span class="function">	<span class="keyword">int</span> nPriority</span>=THREAD_PRIORITY_NORMAL,</span><br><span class="line">	UINT nStackSize=<span class="number">0</span>,</span><br><span class="line">	DWORD dwCreateFlags=<span class="number">0</span>,</span><br><span class="line">	LPSECURITY_ATTRIBUTES lpSecurityAttrs=<span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure>
<details class="folding-tag" ><summary> 使用MFC多线程的简单例子 </summary>
              <div class='content'>
              <blockquote><p>Win32控制台应用程序，项目名06MFCWorkerThread，选空项目，去预编译头、去SDL</p><p>项目-属性-<code>在共享DLL中使用MFC</code></p></blockquote><p>新建源文件<code>MFCWorkerThread.cpp</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;afxwin.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">UINT <span class="title">MyFunc</span><span class="params">(LPVOID)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;我的线程ID是:%d\n&quot;</span>, <span class="built_in">AfxGetThread</span>()-&gt;m_nThreadID);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">AfxBeginThread</span>(MyFunc, <span class="literal">NULL</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行：</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211115163453006.png" alt="image-20211115163453006"></p>
              </div>
            </details>
<p>AfxBeginThread()创建线程的流程不论哪个AfxBeginThread()，首先都是创建MFC线程对象，然后创建Win32线程对象。</p>
<p><code>AfxBeginThread创建线程的流程图</code></p>
<p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/1606677-20190311204758391-1595626385.png" alt="img"></p>
<h4 id="MFC线程技术剖析">MFC线程技术剖析</h4>
<p>MFC的核心类库中有一个名为CWinThread的类，这个类在MFC的底层机理中占举足轻重的地位。</p>
<p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211115192528572.png" alt="image-20211115192528572"></p>
<p>线程状态用类_AFX_THREAD_STATE描述;模块状态用类_AFX_MODULE_STATE描述;模块-线程状态用类_AFX_MODULE_THREAD_STATE描述。这些类都从类CNoTrackObject派生。</p>
<p>进程状态用类_AFX_BASE_MODULE_STATE描述，从模块状态_AFX_MODULE_STATE派生。</p>
<p>进程状态是一个可以独立执行的MFC应用程序的模块状态。还有其他状态如DLL的模块状态等也从模块状态类_AFX_MODULE_STATE派生。</p>
<p>MFC状态类的层次：</p>
<p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/1606677-20190311205013773-1733349773.png" alt="img"></p>
<p>模块、线程、模块-线程状态的关系</p>
<p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/1606677-20190311205027669-1132928868.png" alt="img"></p>
<h4 id="多线程实践案例：多线程文件搜索器">多线程实践案例：多线程文件搜索器</h4>
<p>前继知识：搜索文件的api</p>
<p>查找文件的时候，首先使用<code>FindFirstFile</code>函数，如果函数执行成功，返回句柄<code>hFindFile</code>来对应这个寻找操作，接下来可以利用这个句柄循环调用FindNextFile函数继续查找其他文件，直到该函数返回失败（FALSE）为止。最后还要调用<code>FindClose</code>函数关闭<code>hFindFile</code>句柄</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hFindFile=::<span class="built_in">FindFirstFile</span>(lpFileName,lpFindData);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(hFindFile!=INVALID_HANDLE_VALUE)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">do</span>&#123;</span><br><span class="line">		<span class="comment">//..//处理本次找到的文件</span></span><br><span class="line">	&#125;<span class="keyword">while</span>(::<span class="built_in">FindNextFile</span>(hFindFile,lpFindData));</span><br><span class="line">	::<span class="built_in">FindClose</span>(hFindFile);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<details class="folding-tag" ><summary> 小例子 </summary>
              <div class='content'>
              <blockquote><p>Win32控制台应用程序，项目名<code>07MultiThreadFindFile</code>，选空项目，去预编译头、去SDL</p><p>项目-属性-<code>在共享DLL中使用MFC</code>，<code>使用多字节字符集</code></p></blockquote><p>新建源文件<code>FileFind.cpp</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;afxwin.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> szFileName[] = <span class="string">&quot;d:\\Codefield\\*.*&quot;</span>;</span><br><span class="line">	WIN32_FIND_DATA findData;</span><br><span class="line">	HANDLE hFindFile;</span><br><span class="line"></span><br><span class="line">	hFindFile = ::<span class="built_in">FindFirstFile</span>(szFileName, &amp;findData);</span><br><span class="line">	<span class="keyword">if</span> (hFindFile != INVALID_HANDLE_VALUE)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">do</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (findData.cFileName[<span class="number">0</span>] == <span class="string">&#x27;.&#x27;</span>) <span class="comment">//不打印.和..</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (findData.dwFileAttributes &amp; FILE_ATTRIBUTE_DIRECTORY) <span class="comment">//是目录就打印</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;%s \n&quot;</span>, findData.cFileName);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">while</span> (::<span class="built_in">FindNextFile</span>(hFindFile, &amp;findData));</span><br><span class="line">		::<span class="built_in">FindClose</span>(hFindFile);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行：</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211115201443315.png" alt="image-20211115201443315"></p><p>我电脑D盘下的Codefield目录</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211115201708380.png" alt="image-20211115201708380"></p><details class="folding-tag" ><summary> 如果去掉continue那个if </summary>              <div class='content'>              <figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;afxwin.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">	char szFileName[] = &quot;d:\\Codefield\\*.*&quot;;</span><br><span class="line">	WIN32_FIND_DATA findData;</span><br><span class="line">	HANDLE hFindFile;</span><br><span class="line"></span><br><span class="line">	hFindFile = ::FindFirstFile(szFileName, &amp;findData);</span><br><span class="line">	if (hFindFile != INVALID_HANDLE_VALUE)</span><br><span class="line">	&#123;</span><br><span class="line">		do</span><br><span class="line">		&#123;</span><br><span class="line"><span class="deletion">-			if (findData.cFileName[0] == &#x27;.&#x27;) //不打印.和..</span></span><br><span class="line"><span class="deletion">-			&#123;</span></span><br><span class="line"><span class="deletion">-				continue;</span></span><br><span class="line"><span class="deletion">-			&#125;</span></span><br><span class="line">			if (findData.dwFileAttributes &amp; FILE_ATTRIBUTE_DIRECTORY) //是目录就打印</span><br><span class="line">			&#123;</span><br><span class="line">				printf(&quot;%s \n&quot;, findData.cFileName);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; while (::FindNextFile(hFindFile, &amp;findData));</span><br><span class="line">		::FindClose(hFindFile);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	system(&quot;pause&quot;);</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行：</p><p>多了.和…</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211115201535980.png" alt="image-20211115201535980"></p>              </div>            </details>
              </div>
            </details>
<hr>
<p>多线程实践案例：（多线程文件查找器）</p>
<p>文件搜索器要在指定的目录及所有子层目录中查找文件，然后向用户显示出查找的结果。如果使用多线程的话，就意味着各线程要同时在不同目录中搜索文件。</p>
<p>这个程序最关键的地方是定义了一个动态的目录列表。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CTypedSimpleList&lt;CDirectoryNode*&gt; m_listDir;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CDirectoryNode</span> :</span> <span class="keyword">public</span> CNoTrackObject</span><br><span class="line">&#123;</span><br><span class="line">    CDirectoryNode* pNext; <span class="comment">// CTypedSimpleList类模板要用此成员</span></span><br><span class="line">    <span class="keyword">char</span> szDir[MAX_PATH];  <span class="comment">// 要查找的目录</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在线程执行查找文件任务的时候，</p>
<p>如果找到的是目录就将它添加到列表中</p>
<p>若找到的是文件，就用自定义CheckFile函数进行比较，判断是否符合查找条件，若符合就打印出来，显示给用户。</p>
<p>线程在查找完一个目录以后，再从m_listDir列表中取出一个新的目录进行查找，同时将该目录对应的结点从表中删除。</p>
<p>当m_listDir为空时，线程进入暂停状态，等待其他线程向m_listDir中添加新的目录。</p>
<details class="folding-tag" ><summary> 代码实现及运行结果 </summary>
              <div class='content'>
              <div class="tabs" id="test4"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#test4-1">FileFind.cpp</button></li><li class="tab"><button type="button" data-href="#test4-2">RapidFind.h</button></li><li class="tab"><button type="button" data-href="#test4-3">RapidFind.cpp</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="test4-1"><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;afxwin.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;RapidFind.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">UINT <span class="title">FinderEntry</span><span class="params">(LPVOID lpParam)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	CRapidFinder* pFinder = <span class="keyword">new</span> <span class="built_in">CRapidFinder</span>(<span class="number">64</span>);<span class="comment">//开64个线程</span></span><br><span class="line">	CDirectoryNode* pNode = <span class="keyword">new</span> CDirectoryNode;<span class="comment">//创建结点</span></span><br><span class="line"></span><br><span class="line">											   <span class="comment">//测试的数据，查询D盘下所有含有stdafx字符串的文件 </span></span><br><span class="line">	<span class="keyword">char</span> szPath[] = <span class="string">&quot;D:\\&quot;</span>;<span class="comment">//需要查找的目录</span></span><br><span class="line">	<span class="keyword">char</span> szFile[] = <span class="string">&quot;stdafx&quot;</span>;<span class="comment">//需要查找的字符串</span></span><br><span class="line"></span><br><span class="line">							 <span class="comment">//对CRapider的信息进行设置</span></span><br><span class="line">	<span class="built_in">strcpy</span>(pNode-&gt;szDir, szPath);<span class="comment">//设置要搜索的目录</span></span><br><span class="line">	pFinder-&gt;m_listDir.<span class="built_in">AddHead</span>(pNode);<span class="comment">//将要搜索的目录添加到list中，当做头结点</span></span><br><span class="line">	<span class="built_in">strcpy</span>(pFinder-&gt;m_szMatchName, szFile);<span class="comment">//需要搜素的文件名</span></span><br><span class="line"></span><br><span class="line">										   <span class="comment">//创建辅助线程</span></span><br><span class="line">	pFinder-&gt;m_nThreadCount = pFinder-&gt;m_nMaxThread;</span><br><span class="line">	<span class="comment">//创建辅助线程，并等待查找结束</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; pFinder-&gt;m_nMaxThread; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">AfxBeginThread</span>(FinderEntry, pFinder);</span><br><span class="line">	&#125;</span><br><span class="line">	::<span class="built_in">WaitForSingleObject</span>(pFinder-&gt;m_hExitEvent, INFINITE);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//打印查找结果</span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;一共找到了同名文件%d\n&quot;</span>, pFinder-&gt;m_nResultCount);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">delete</span> pFinder;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">system</span>(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">UINT <span class="title">FinderEntry</span><span class="params">(LPVOID lpParam)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	CRapidFinder* pFinder = (CRapidFinder*)lpParam;</span><br><span class="line">	CDirectoryNode* pNode = <span class="literal">NULL</span>;<span class="comment">//m_listDir从pNode中获取</span></span><br><span class="line">	BOOL bActive = TRUE;<span class="comment">//当前线程工作状态（既然进入了线程回调函数，肯定是TRUE）</span></span><br><span class="line"></span><br><span class="line">						<span class="comment">//只要m_listDir有目录</span></span><br><span class="line">	<span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//取出待查的新目录</span></span><br><span class="line">		<span class="comment">//这个动作各线程之间要互斥完成，临界区代码前后控制一下</span></span><br><span class="line">		::<span class="built_in">EnterCriticalSection</span>(&amp;pFinder-&gt;m_cs);</span><br><span class="line">		<span class="keyword">if</span> (pFinder-&gt;m_listDir.<span class="built_in">IsEmpty</span>())<span class="comment">//是否为空</span></span><br><span class="line">		&#123;</span><br><span class="line">			bActive = FALSE;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span><span class="comment">//不为空，取出目录</span></span><br><span class="line">		&#123;</span><br><span class="line">			pNode = pFinder-&gt;m_listDir.<span class="built_in">GetHead</span>();</span><br><span class="line">			pFinder-&gt;m_listDir.<span class="built_in">Remove</span>(pNode);</span><br><span class="line">		&#125;</span><br><span class="line">		::<span class="built_in">LeaveCriticalSection</span>(&amp;pFinder-&gt;m_cs);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//bActive指示了当前线程的工作状态</span></span><br><span class="line">		<span class="comment">//如果m_listDir队列当前为空，那么我们当前线程先等待。</span></span><br><span class="line">		<span class="comment">//eg.9个线程停止了，1个线程还在工作，但9个线程不能释放掉，因为剩下的1个工作线程如果发现新的目录，要分配9个线程过来帮忙</span></span><br><span class="line">		<span class="keyword">if</span> (!bActive)</span><br><span class="line">		&#123;</span><br><span class="line">			::<span class="built_in">EnterCriticalSection</span>(&amp;pFinder-&gt;m_cs);</span><br><span class="line">			pFinder-&gt;m_nThreadCount--;<span class="comment">//前后通过临界区锁控制了这条语句的唯一性，防止线程之间切换带来的不可预料</span></span><br><span class="line">			<span class="keyword">if</span> (pFinder-&gt;m_nThreadCount == <span class="number">0</span>)<span class="comment">//没有线程在工作，都在等待中。那么离开临界区</span></span><br><span class="line">			&#123;</span><br><span class="line">				::<span class="built_in">LeaveCriticalSection</span>(&amp;pFinder-&gt;m_cs);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			::<span class="built_in">LeaveCriticalSection</span>(&amp;pFinder-&gt;m_cs);</span><br><span class="line"></span><br><span class="line">			<span class="comment">//进入等待状态</span></span><br><span class="line">			<span class="built_in">ResetEvent</span>(pFinder-&gt;m_hDirEvent);<span class="comment">//告诉总线程，我在等待，如果有发现新目录可以通知我去干活</span></span><br><span class="line">			::<span class="built_in">WaitForSingleObject</span>(pFinder-&gt;m_hDirEvent, INFINITE);</span><br><span class="line"></span><br><span class="line">			::<span class="built_in">EnterCriticalSection</span>(&amp;pFinder-&gt;m_cs);</span><br><span class="line">			<span class="comment">//此时当前线程再度获得CPU的推进机会</span></span><br><span class="line">			pFinder-&gt;m_nThreadCount++;<span class="comment">//当前的活动线程数量+1</span></span><br><span class="line">			::<span class="built_in">LeaveCriticalSection</span>(&amp;pFinder-&gt;m_cs);</span><br><span class="line"></span><br><span class="line">			bActive = TRUE;</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/********************************实现基于pNode的目录查找*******************************/</span></span><br><span class="line">		WIN32_FIND_DATA fileData;</span><br><span class="line">		HANDLE hFindFile;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (pNode-&gt;szDir[<span class="built_in">strlen</span>(pNode-&gt;szDir) - <span class="number">1</span>] != <span class="string">&#x27;\\&#x27;</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">strcat</span>(pNode-&gt;szDir, <span class="string">&quot;\\&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">strcat</span>(pNode-&gt;szDir, <span class="string">&quot;*.*&quot;</span>);</span><br><span class="line"></span><br><span class="line">		hFindFile = ::<span class="built_in">FindFirstFile</span>(pNode-&gt;szDir, &amp;fileData);</span><br><span class="line">		<span class="keyword">if</span> (hFindFile != INVALID_HANDLE_VALUE)</span><br><span class="line">		&#123;<span class="comment">//是目录，添加到m_listDir</span></span><br><span class="line">			<span class="keyword">do</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span> (fileData.cFileName[<span class="number">0</span>] == <span class="string">&#x27;.&#x27;</span>)<span class="comment">//不打印.和..</span></span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">continue</span>;</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (fileData.dwFileAttributes&amp;FILE_ATTRIBUTE_DIRECTORY)<span class="comment">//如果是目录，则添加进m_listDir</span></span><br><span class="line">				&#123;</span><br><span class="line">					CDirectoryNode* p = <span class="keyword">new</span> CDirectoryNode;</span><br><span class="line">					<span class="built_in">strncpy</span>(p-&gt;szDir, pNode-&gt;szDir, <span class="built_in">strlen</span>(pNode-&gt;szDir) - <span class="number">3</span>);</span><br><span class="line">					<span class="built_in">strcat</span>(p-&gt;szDir, fileData.cFileName);</span><br><span class="line"></span><br><span class="line">					::<span class="built_in">EnterCriticalSection</span>(&amp;pFinder-&gt;m_cs);</span><br><span class="line">					pFinder-&gt;m_listDir.<span class="built_in">AddHead</span>(p);</span><br><span class="line">					::<span class="built_in">LeaveCriticalSection</span>(&amp;pFinder-&gt;m_cs);</span><br><span class="line"></span><br><span class="line">					<span class="comment">//将一个事件对象设置为受信状态</span></span><br><span class="line">					<span class="comment">//唤醒一个线程</span></span><br><span class="line">					<span class="built_in">SetEvent</span>(pFinder-&gt;m_hDirEvent);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span><span class="comment">//如果是文件</span></span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">if</span> (pFinder-&gt;<span class="built_in">CheckFile</span>(fileData.cFileName))<span class="comment">//找到文件名</span></span><br><span class="line">					&#123;</span><br><span class="line">						::<span class="built_in">EnterCriticalSection</span>(&amp;pFinder-&gt;m_cs);</span><br><span class="line">						::<span class="built_in">InterlockedIncrement</span>((<span class="keyword">long</span>*)&amp;pFinder-&gt;m_nResultCount);<span class="comment">//找到的文件的数量+1</span></span><br><span class="line">						::<span class="built_in">LeaveCriticalSection</span>(&amp;pFinder-&gt;m_cs);</span><br><span class="line">						<span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, fileData.cFileName);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; <span class="keyword">while</span> (::<span class="built_in">FindNextFile</span>(hFindFile, &amp;fileData));</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//以上，此结点的保存的目录已经全部搜索完毕</span></span><br><span class="line">		<span class="keyword">delete</span> pNode;</span><br><span class="line">		pNode = <span class="literal">NULL</span>;<span class="comment">//删完设置为空</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	::<span class="built_in">SetEvent</span>(pFinder-&gt;m_hDirEvent);</span><br><span class="line">	<span class="comment">//判断当前线程是否是最后一个结束循环的线程</span></span><br><span class="line">	<span class="keyword">if</span> (::<span class="built_in">WaitForSingleObject</span>(pFinder-&gt;m_hDirEvent, <span class="number">0</span>) != WAIT_TIMEOUT)<span class="comment">//如果没超时</span></span><br><span class="line">	&#123;   <span class="comment">//则通知主线程，最后一个搜索线程已经结束了</span></span><br><span class="line">		::<span class="built_in">SetEvent</span>(pFinder-&gt;m_hExitEvent);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//int main(void)</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//	char szFileName[] = &quot;d:\\Codefield\\*.*&quot;;</span></span><br><span class="line"><span class="comment">//	WIN32_FIND_DATA findData;</span></span><br><span class="line"><span class="comment">//	HANDLE hFindFile;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	hFindFile = ::FindFirstFile(szFileName, &amp;findData);</span></span><br><span class="line"><span class="comment">//	if (hFindFile != INVALID_HANDLE_VALUE)</span></span><br><span class="line"><span class="comment">//	&#123;</span></span><br><span class="line"><span class="comment">//		do &#123;</span></span><br><span class="line"><span class="comment">//			//if (findData.cFileName[0] == &#x27;.&#x27;)</span></span><br><span class="line"><span class="comment">//			//&#123;</span></span><br><span class="line"><span class="comment">//			//	continue;</span></span><br><span class="line"><span class="comment">//			//&#125;</span></span><br><span class="line"><span class="comment">//			if (findData.dwFileAttributes&amp;FILE_ATTRIBUTE_DIRECTORY)</span></span><br><span class="line"><span class="comment">//			&#123;</span></span><br><span class="line"><span class="comment">//				printf(&quot;%s \n&quot;, findData.cFileName);</span></span><br><span class="line"><span class="comment">//			&#125;</span></span><br><span class="line"><span class="comment">//		&#125; while (::FindNextFile(hFindFile, &amp;findData));</span></span><br><span class="line"><span class="comment">//		::FindClose(hFindFile);</span></span><br><span class="line"><span class="comment">//	&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//	system(&quot;pause&quot;);</span></span><br><span class="line"><span class="comment">//	return 0;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-2"><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;afxwin.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">CDirectoryNode</span> :</span><span class="keyword">public</span> CNoTrackObject &#123;<span class="comment">//文件夹目录结构体</span></span><br><span class="line">	CDirectoryNode* pNext;<span class="comment">//链表的指针域</span></span><br><span class="line">	<span class="keyword">char</span> szDir[MAX_PATH];<span class="comment">//文件夹名称</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CRapidFinder</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">CRapidFinder</span>(<span class="keyword">int</span> nMaxThread);<span class="comment">//构造函数</span></span><br><span class="line">	<span class="keyword">virtual</span> ~<span class="built_in">CRapidFinder</span>();<span class="comment">//虚析构函数</span></span><br><span class="line"></span><br><span class="line">	<span class="function">BOOL <span class="title">CheckFile</span><span class="params">(LPCTSTR lpszFileName)</span></span>;<span class="comment">//判断是否是要查找的文件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="keyword">int</span> m_nResultCount;<span class="comment">//结果的数量</span></span><br><span class="line">	<span class="keyword">int</span> m_nThreadCount;<span class="comment">//活动线程的数量</span></span><br><span class="line"></span><br><span class="line">	CTypedSimpleList&lt;CDirectoryNode*&gt; m_listDir;<span class="comment">//文件夹列表</span></span><br><span class="line"></span><br><span class="line">	CRITICAL_SECTION m_cs;<span class="comment">//临界区</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">int</span> m_nMaxThread;<span class="comment">//最大线程数量</span></span><br><span class="line">	<span class="keyword">char</span> m_szMatchName[MAX_PATH];<span class="comment">//要搜索的文件</span></span><br><span class="line"></span><br><span class="line">								 <span class="comment">//通知线程的工作状态</span></span><br><span class="line">	HANDLE m_hDirEvent;<span class="comment">//我们向m_listDir添加新的目录，授信  10个线程，9个停止，1个工作 若m_listDir为空，线程不能停止</span></span><br><span class="line">	HANDLE m_hExitEvent;<span class="comment">//各个搜索线程是否已经结束</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="test4-3"><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;RapidFind.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//初始化我们的m_nMaxThread</span></span><br><span class="line">CRapidFinder::<span class="built_in">CRapidFinder</span>(<span class="keyword">int</span> nMaxThread) :<span class="built_in">m_nMaxThread</span>(nMaxThread)</span><br><span class="line">&#123;</span><br><span class="line">	m_nResultCount = <span class="number">0</span>;<span class="comment">//构造函数初始化为0，一开始肯定找到0个</span></span><br><span class="line">	m_nThreadCount = <span class="number">0</span>;<span class="comment">//同上，活动线程数量为0</span></span><br><span class="line">	m_szMatchName[<span class="number">0</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"></span><br><span class="line">	m_listDir.<span class="built_in">Construct</span>(<span class="built_in">offsetof</span>(CDirectoryNode, pNext));<span class="comment">//调用CTypedSimpleList的构造方法</span></span><br><span class="line">	m_hDirEvent = ::<span class="built_in">CreateEvent</span>(<span class="literal">NULL</span>, FALSE, FALSE, <span class="literal">NULL</span>);<span class="comment">//创建事件对象</span></span><br><span class="line">	m_hExitEvent = ::<span class="built_in">CreateEvent</span>(<span class="literal">NULL</span>, FALSE, FALSE, <span class="literal">NULL</span>);<span class="comment">//创建事件对象</span></span><br><span class="line">	::<span class="built_in">InitializeCriticalSection</span>(&amp;m_cs);<span class="comment">//初始化临界区对象</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CRapidFinder::~<span class="built_in">CRapidFinder</span>()</span><br><span class="line">&#123;</span><br><span class="line">	::<span class="built_in">CloseHandle</span>(m_hDirEvent);<span class="comment">//关闭句柄</span></span><br><span class="line">	::<span class="built_in">CloseHandle</span>(m_hExitEvent);<span class="comment">//关闭句柄</span></span><br><span class="line">	::<span class="built_in">DeleteCriticalSection</span>(&amp;m_cs);<span class="comment">//删除临界区对象</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过比对文件名的方式检查搜到的文件是不是要搜索的文件，这里不采用md5检验和的方式</span></span><br><span class="line"><span class="function">BOOL <span class="title">CRapidFinder::CheckFile</span><span class="params">(LPCTSTR lpszFileName)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> string[MAX_PATH];</span><br><span class="line">	<span class="keyword">char</span> strSearch[MAX_PATH];</span><br><span class="line">	<span class="built_in">strcpy</span>(string, lpszFileName);<span class="comment">//把从src地址开始且含有NULL结束符的字符串复制到以dest开始的地址空间</span></span><br><span class="line">	<span class="built_in">strcpy</span>(strSearch, m_szMatchName);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//将字符串全部转换为大写</span></span><br><span class="line">	_strupr(string);</span><br><span class="line">	_strupr(strSearch);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//strstr返回字符串中首次出现子串的地址</span></span><br><span class="line">	<span class="comment">//比如有a.txt文件，用户可能输入搜索a，它不输入后缀名</span></span><br><span class="line">	<span class="comment">//这里我们用包含关系</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">strstr</span>(string, strSearch) != <span class="literal">NULL</span>)<span class="comment">//查找的文件名在里面</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> TRUE;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> FALSE;<span class="comment">//默认不相同</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div><p>运行结果：</p><p>（程序中搜的是D盘下stdafx文件（预编译的头文件））</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211116171849882.png" alt="image-20211116171849882"></p><details class="folding-tag" ><summary> 消息循环的Crash bug </summary>              <div class='content'>              <p><code>FileFind.cpp</code>文件中76~78行</p><p>如果是写INFINITY，在运行时，快输出总共找到同名文件多少时，会有中断异常</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">			//进入等待状态</span><br><span class="line">			ResetEvent(pFinder-&gt;m_hDirEvent);//告诉总线程，我在等待，如果有发现新目录可以通知我去干活</span><br><span class="line"><span class="deletion">-			::WaitForSingleObject(pFinder-&gt;m_hDirEvent, INFINITE);</span></span><br><span class="line"><span class="addition">+			::WaitForSingleObject(pFinder-&gt;m_hDirEvent, INFINITY);</span></span><br></pre></td></tr></table></figure><p>在win32线程中INFINITE和INFINch差别不明显。但是在MFC中使用INFINITY会一直等待下去，导致工作者线程就不会进入消息循环，导致总线程crash掉</p>              </div>            </details>
              </div>
            </details>
<h3 id="MFC多线程技术（线程间通信）">MFC多线程技术（线程间通信）</h3>
<p>一般而言，应用程序中的一个次要线程总是为主线程执行特定的任务，这样，主线程和次要线程间必定有一个信息传递的渠道，也就是主线程和次要线程间要进行通信。这种线程间的通信不但是难以避免的，而且在多线程编程中也是复杂和频繁的，下面对通信方式进行简要说明：</p>
<p>使用全局变量进行通信</p>
<ul>
<li>如果线程间所需传递的信息较复杂，我们可以定义一个结构，通过传递指向该结构的指针进行传递消息。</li>
</ul>
<p>使用自定义消息</p>
<ul>
<li>我们可以在一个线程的执行函数中向另一个线程发送自定义的消息来达到通信的目的。一个线程向另外一个线程发送消息是通过操作系统实现的。利用Windows操作系统的消息驱动机制，当一个线程发出一条消息时，操作系统首先接收到该消息，然后把该消息转发给目标线程，接收消息的线程必须已经建立了消息循环。</li>
</ul>
<hr>
<p>案例：编写一个应用程序，在主窗口按下鼠标左键的时候，会启动一个用户UI线程；当用户在线程窗口界面按下鼠标左键的时候，会弹出一个信息框。</p>
<details class="folding-tag" ><summary> 实现 </summary>
              <div class='content'>
              <blockquote><p>创建MFC应用程序项目08MFCUIDEMO；基于对话框，去SDL检查；去系统菜单；高级功能全去</p></blockquote><p>在<code>资源文件</code>添加一个Dialog资源，添加<code>Static Text</code>控件，<code>Caption</code>修改为线程窗口</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211116205221391.png" alt="image-20211116205221391"></p><p>对该对话框右键<code>添加类</code>，类名为<code>CThreadWnd</code>；</p><p>VS2015会自动生成<code>ThreadWnd.h</code>、<code>ThreaddWnd.cpp</code>文件</p><details class="folding-tag" ><summary> 用窗口的方式实现 </summary>              <div class='content'>              <p>在主对话框中，右键<code>类向导</code>，<code>消息</code>中添加<code>WM_LBUTTONDOWM</code>消息的处理</p><p>程序；</p><p>在<code>08MFCUIDEMODlg.cpp</code>文件中<code>#include &quot;ThreadWnd.h&quot;</code></p><p>并编辑上述添加的处理程序代码为：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CMy08MFCUIDEMODlg::OnLButtonDown</span><span class="params">(UINT nFlags, CPoint point)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加消息处理程序代码和/或调用默认值</span></span><br><span class="line">	<span class="comment">//AfxMessageBox(TEXT(&quot;Hello&quot;));用弹窗检验一下</span></span><br><span class="line">	</span><br><span class="line">	CThreadWnd *pDlg = <span class="keyword">new</span> <span class="built_in">CThreadWnd</span>();</span><br><span class="line">	pDlg-&gt;<span class="built_in">DoModal</span>();</span><br><span class="line"></span><br><span class="line">	CDialogEx::<span class="built_in">OnLButtonDown</span>(nFlags, point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行：</p><p>在主窗口点击左键会弹出对话框，不把次对话框关闭，主界面就不响应鼠标的左键点击</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211117155702315.png" alt="image-20211117155702315"></p>              </div>            </details><details class="folding-tag" ><summary> 用UI线程的方法弹出窗口 </summary>              <div class='content'>              <p>次窗口的对话框中<kbd>类向导</kbd>，<kbd>添加类</kbd></p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211117100859457.png" alt="image-20211117100859457"></p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211117101015010.png" alt="image-20211117101015010"></p><p><code>类名</code>输为<code>CMyThread</code>，<code>基类</code>输为<code>CWndThread</code>；VS2015会自动生成<code>CMyThread.h</code>和<code>MyThread.cpp</code>文件</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211117112200808.png" alt="image-20211117112200808"></p><p>在<kbd>虚函数</kbd>中选中<code>InitInstance</code>、<code>ExitInstance</code>，<kbd>添加函数</kbd></p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211117112343950.png" alt="image-20211117112343950"></p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211117112541941.png" alt="image-20211117112541941"></p><p>在VS2015生成的<code>MyThread.cpp</code>文件前<code>#include &quot;ThreadWnd.h&quot;</code>，同时编写函数体</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">BOOL <span class="title">CMyThread::InitInstance</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加专用代码和/或调用基类</span></span><br><span class="line"></span><br><span class="line">	CThreadWnd *pDlg = <span class="keyword">new</span> <span class="built_in">CThreadWnd</span>();</span><br><span class="line">	pDlg-&gt;<span class="built_in">DoModal</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> CWinThread::<span class="built_in">InitInstance</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在<code>08MFCUIDEMODlg.cpp</code>文件前<code>#include &quot;MyThread.h&quot;</code>,同时编写函数体</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CMy08MFCUIDEMODlg::OnLButtonDown</span><span class="params">(UINT nFlags, CPoint point)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> 在此添加消息处理程序代码和/或调用默认值</span></span><br><span class="line">	<span class="comment">//AfxMessageBox(TEXT(&quot;Hello&quot;));用弹窗检验一下</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//CThreadWnd *pDlg = new CThreadWnd();</span></span><br><span class="line">	<span class="comment">//pDlg-&gt;DoModal();</span></span><br><span class="line"></span><br><span class="line">	CMyThread* pThread = <span class="keyword">new</span> <span class="built_in">CMyThread</span>();</span><br><span class="line">	pThread-&gt;<span class="built_in">CreateThread</span>();<span class="comment">//CWinThread类的方法</span></span><br><span class="line"></span><br><span class="line">	CDialogEx::<span class="built_in">OnLButtonDown</span>(nFlags, point);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行：</p><p>在主窗口点击左键会弹出对话框，不把次对话框关闭，主界面也不响应鼠标的左键点击</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211117160345128.png" alt="image-20211117160345128"></p>              </div>            </details>
              </div>
            </details>
<p>DoModal阻塞的是窗体消息</p>
<p>MFC之所以会分成所谓的UI线程和工作者线程和核心区别在于二者是否加入窗体消息循环</p>
<details class="folding-tag" ><summary> 关于UI线程和工作者线程更多的资料 </summary>
              <div class='content'>
              <p><a target="_blank" rel="noopener" href="https://blog.csdn.net/libaineu2004/article/details/40398405">UI线程和工作者线程</a></p>
              </div>
            </details>
<h3 id="自定义消息通信机制综合案例：日志切割器">自定义消息通信机制综合案例：日志切割器</h3>
<p>MFC中多线程技术分为UI线程和工作者线程。核心思想是希望我们把耗时长的操作（比如文件读写）放到工作者线程中，这些操作在执行过程中不会占用消息循环。如果放到UI线程，占用消息循环，会造成主界面假死用户交互体验差。</p>
<p>这是逻辑上的一个划分，那么UI线程与工作者线程之间不可避免需要通信。</p>
<p>本节用日志切割器的案例来学习与体会线程间通信和同步问题。</p>
<hr>
<p>读写文件是编程过程中一个很重要的环节。为了消除长时间的读写操作对线程造成的阻塞，一般都要在辅助线程中读写文件。这就涉及到线程间通信和线程同步的问题。</p>
<p>本节将通过实现一个日志切割系统来说明如何将线程封装到类中，提供线程安全的接口，最终将以一个CFileCutter类的形式提供给用户使用。</p>
<p><strong>现实意义</strong>：早期windows的服务器，每当有外来用户进行访问，log日志便会记录，log日志会不断增长，用记事本打开这样大的日志会非常缓慢。因此，我们对该日志进行切割，变成小文件，方便访问。</p>
<p><strong>分析</strong>：这种读写文件的操作肯定放到工作者线程，如果放到界面会卡死，用户体验差。</p>
<p><strong>设计</strong>：</p>
<p>线程间通信的方法很多，如果是工作线程有事情要通知主窗口线程，最好的方法就是发送消息。除了要向主窗口发送基本的“开始工作”和“结束工作”通知消息外，还应该把当前的工作进度告诉主窗口，以便显示给用户。</p>
<p>为此，CFileCutter类定义了以下3个消息：</p>
<p>CFileCutter类发给主窗口的通知消息//FileCutter.h文件</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WM_CUTTERSTART WM_USER + 100  <span class="comment">//wParm==nTatolCount</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WM_CUTTERSTOP WM_USER + 101	  <span class="comment">//wParam==nExiteCode,lParm==nCompletedCount</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WM_CUTTERSTATUS WM_USER + 102 <span class="comment">//lParam==nCompletedCount</span></span></span><br></pre></td></tr></table></figure>
<hr>
<p>我们想增加一个用户自定义消息WM_USER_THREADEND的步骤是：</p>
<ol>
<li>
<p>在头文件<code>stdafx.h</code>中增加一个自定义消息宏</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WM_USER_THREADEND WM_USER + 1</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在增加新消息的窗口或对话框类的头文件中增加一个回调函数声明，注意要声明为</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span></span></span><br><span class="line"><span class="function">afx_msg LRESULT <span class="title">OnUserThreadend</span><span class="params">(WPARAM wParam, LPARAM lParam)</span></span>;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在窗口或对话框的cpp文件的<code>BEGIN_MESSAGE_MAP</code>，<code>END_MESSAGE_MAP</code>中增加一行</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ON_MESSAGE</span>(WM_USER_THREADEND, OnUserThreadend)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>在窗口或对话框的cpp文件中增加回调函数的实现，如：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LRESULT <span class="title">ThreadDialog::OnUserThreadend</span><span class="params">(WPARAM wParam, LPARAM lParam)</span></span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>自定义消息的触发</p>
</li>
</ol>
<hr>
<p>刚开始进行分割时，工作线程向主窗口发送<code>WM_CUTTERSTART</code>消息，<code>wParam</code>参数的值域为分割以后的文件数量。主窗口接收到这个消息后可以设置进度条的取值范围，提示用户正在工作等。</p>
<p>工作线程在分割文件的过程中，每处理完一个文件就向主窗口发送一个<code>WM_CUTTERSTATUS</code>消息，<code>lParam</code>参数的值为已经完成的文件的总数量。主窗口接收到这个消息后可以更新进度条的位置，向用户显示状态信息等。</p>
<p>停止工作以后，工作线程向主窗口发送<code>WM_CUTTERSTOP</code>消息，<code>lParam</code>参数的值还是已经完成的文件的总数量，其<code>wParam</code>参数的值为工作退出代码，说明了工作退出的原因。</p>
<hr>
<p>实现：</p>
<blockquote>
<p>创建Win32项目09MFCLogCutter；勾空项目；直接点完成</p>
<p>项目右键-在共享DLL中使用MFC</p>
</blockquote>
<details class="folding-tag" ><summary> 资源布局 </summary>
              <div class='content'>
              <p>把已经做好的<code>resource.h</code>和<code>FileCutter.rc</code>文件复制到这个项目下</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211117184844960.png" alt="image-20211117184844960"></p><p><kbd>头文件</kbd>右键<kbd>添加</kbd>-&gt;<kbd>现有项</kbd>添加<code>resource.h</code></p><p><kbd>资源文件</kbd>右键<kbd>添加</kbd>-&gt;<kbd>新建项</kbd>添加<code>FileCutter.rc</code></p><p>瞅瞅资源文件</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211117195137905.png" alt="image-20211117195137905"></p>
              </div>
            </details>
<details class="folding-tag" ><summary> 代码基本框架 </summary>
              <div class='content'>
              <p>这里不用App Wizard，手工添加</p><p><kbd>头文件</kbd>右键<kbd>添加</kbd>-&gt;<kbd>现有项</kbd>添加<code>Cutter.h</code></p><p>编写：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;afxwin.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;afxcmn.h&gt;</span><span class="comment">//通用控件</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CMyApp</span> :</span><span class="keyword">public</span> CWinApp &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function">BOOL <span class="title">InitInstance</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CMainDialog</span> :</span><span class="keyword">public</span> CDialog &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">CMainDialog</span>(CWnd* pParentWnd = <span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	<span class="comment">//进度条</span></span><br><span class="line">	CProgressCtrl m_Progress;</span><br><span class="line">	<span class="comment">//辅助类：CFileCutter--To Do--</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//由于我们需要实时更新工作者线程和主线程</span></span><br><span class="line">	<span class="comment">//动态的控制程序界面的函数</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">UIControl</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//相应windows消息的一系列函数</span></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> BOOL <span class="title">OnInitDialog</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnCancel</span><span class="params">()</span></span>;<span class="comment">//退出</span></span><br><span class="line"></span><br><span class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnSourceBrowser</span><span class="params">()</span></span>;<span class="comment">//选择源文件的按钮响应函数</span></span><br><span class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnDestBrowser</span><span class="params">()</span></span>;<span class="comment">//选择目的文件夹的按钮响应函数</span></span><br><span class="line"></span><br><span class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnStart</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnStop</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="function">afx_msg <span class="keyword">void</span> <span class="title">OnSelect</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//自定义消息，需要辅助类，这里先注释没做</span></span><br><span class="line">	<span class="comment">//afx_msg long OnCutterStart(WPARAM wParam, LPARAM lParam);</span></span><br><span class="line">	<span class="comment">//afx_msg long OnCutterStatus(WPARAM wParam, LPARAM lParam);</span></span><br><span class="line">	<span class="comment">//afx_msg long OnCutterStop(WPARAM wParam, LPARAM lParam);</span></span><br><span class="line">	<span class="built_in">DECLARE_MESSAGE_MAP</span>()</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><kbd>源文件</kbd>右键<kbd>添加</kbd>-&gt;<kbd>新建项</kbd>添加<code>Cutter.cpp</code></p><p>编写：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;resource.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Cutter.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">CMyApp theApp;</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">CMyApp::InitInstance</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	CMainDialog dlg;</span><br><span class="line">	m_pMainWnd = &amp;dlg;</span><br><span class="line">	dlg.<span class="built_in">DoModal</span>();</span><br><span class="line">	<span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CMainDialog::<span class="built_in">CMainDialog</span>(CWnd* pParentWnd) :<span class="built_in">CDialog</span>(IDD_FILECUTTER_DIALOG, pParentWnd)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">BEGIN_MESSAGE_MAP</span>(CMainDialog,CDialog)</span><br><span class="line">	<span class="built_in">ON_BN_CLICKED</span>(IDC_SOURCEBROWSER,OnSourceBrowser)</span><br><span class="line">	<span class="built_in">ON_BN_CLICKED</span>(IDC_DESTBROWSER,OnDestBrowser)</span><br><span class="line">	<span class="built_in">ON_BN_CLICKED</span>(IDC_START,OnStart)</span><br><span class="line">	<span class="built_in">ON_BN_CLICKED</span>(IDC_STOP,OnStart)</span><br><span class="line">	<span class="built_in">ON_BN_CLICKED</span>(IDC_SELECTSPLIT,OnSelect)</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//自定义消息：WM_CUTTERSTART：是在我们线程的辅助类里面的，这里先注释后面再实现</span></span><br><span class="line">	<span class="comment">//ON_MESSAGE(WM_CUTTERSTART,OnCutterStart)</span></span><br><span class="line"><span class="built_in">END_MESSAGE_MAP</span>()</span><br><span class="line"></span><br><span class="line"><span class="function">BOOL <span class="title">CMainDialog::OnInitDialog</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	CDialog::<span class="built_in">OnInitDialog</span>();</span><br><span class="line">	<span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CMainDialog::UIControl</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CMainDialog::OnCancel</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CMainDialog::OnSelect</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CMainDialog::OnSourceBrowser</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CMainDialog::OnDestBrowser</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CMainDialog::OnStart</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CMainDialog::OnStop</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>运行：</p><p><img src= "/img/loading.gif" data-lazy-src="/Typora_images/MFC/image-20211117194207831.png" alt="image-20211117194207831"></p>
              </div>
            </details>
<p>核心代码：</p>
<kbd>头文件</kbd>右键<kbd>添加</kbd>-><kbd>新建项</kbd>添加`FileCutter.h`
<p>编写：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;afxwin.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义自定义消息</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WM_CUTTERSTART WM_USER+100<span class="comment">//wParam封装的时nTotal</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WM_CUTTERSTOP WM_USER+101<span class="comment">//wParam=nExitCode,lParam=nCompleteCount</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WM_CUTTERSTATUS WM_USER+102<span class="comment">//lParam=完成的数量</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CFileCutter</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="comment">//工作码</span></span><br><span class="line">	<span class="class"><span class="keyword">enum</span> <span class="title">ExitCode</span> &#123;</span></span><br><span class="line">		exitSuccess,<span class="comment">//成功退出</span></span><br><span class="line">		exitUserForce,<span class="comment">//用户强制退出</span></span><br><span class="line">		exitSourceErr,<span class="comment">//文件有错误，工作时文件突然没了</span></span><br><span class="line">		exitDestErr</span><br><span class="line">	&#125;;<span class="comment">//我们永远不能轻信多线程的推进是可靠的</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//构造函数</span></span><br><span class="line">	<span class="built_in">CFileCutter</span>(HWND hWndNotify);<span class="comment">//要传句柄，因为工作者线程要和窗体通信</span></span><br><span class="line">	<span class="comment">//析构函数</span></span><br><span class="line">	~<span class="built_in">CFileCutter</span>();</span><br><span class="line"></span><br><span class="line">	<span class="function">BOOL <span class="title">IsRunning</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123; <span class="keyword">return</span> m_bRunning; &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function">BOOL <span class="title">StartSplit</span><span class="params">(LPCTSTR lpszDDwstDir, LPCTSTR lpszSourceFile, UINT uFileSize)</span></span>;<span class="comment">//开始切割</span></span><br><span class="line"></span><br><span class="line">	<span class="function">BOOL <span class="title">SuspendCutter</span><span class="params">()</span></span>;<span class="comment">//暂停切割</span></span><br><span class="line"></span><br><span class="line">	<span class="function">BOOL <span class="title">ResumeCutter</span><span class="params">()</span></span>;<span class="comment">//继续切割</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">StopCutter</span><span class="params">()</span></span>;<span class="comment">//停止切割</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">	<span class="comment">//设置状态</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Reset</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">DoSplit</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	UINT <span class="keyword">friend</span> _CutterEntry(LPVOID lpParam);<span class="comment">//线程会侵入别的模块，这里我们用友元</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//参数信息</span></span><br><span class="line">	CString m_strSource;<span class="comment">//源文件</span></span><br><span class="line">	CString m_strDest;<span class="comment">//目标文件夹</span></span><br><span class="line">	UINT m_uFileSize;<span class="comment">//文件单元大小</span></span><br><span class="line">	BOOL m_bSplit;<span class="comment">//切割情况</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//状态标志</span></span><br><span class="line">	BOOL m_bContinue;</span><br><span class="line">	BOOL m_bRunning;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//同步</span></span><br><span class="line">	CRITICAL_SECTION m_cs;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	HWND m_hWndNotify;<span class="comment">//接收UI线程和当前工作线程的窗口句柄</span></span><br><span class="line">	HANDLE m_hWorkEvent;<span class="comment">//通知开始工作线程的事件对象</span></span><br><span class="line">	CWinThread* m_pThread;<span class="comment">//工作线程</span></span><br><span class="line">	BOOL m_bSuspend;<span class="comment">//是否暂停</span></span><br><span class="line">	BOOL m_bExitThread;<span class="comment">//是否退出</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<kbd>源文件</kbd>右键<kbd>添加</kbd>-><kbd>新建项</kbd>添加`FileCutter.cpp`
<p>编写：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>用临界区确保唯一性</p>
<h2 id="原理篇二-MFC核心框架完全实现">原理篇二-MFC核心框架完全实现</h2>
<h2 id="工程篇-MFC通用技术">工程篇-MFC通用技术</h2>
<h2 id="综合案例-拼图游戏">综合案例-拼图游戏</h2>
<h2 id="MFC案例-视频图像摄像头">MFC案例-视频图像摄像头</h2>
</article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>MFC</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="https://jyxyz.github.io/posts/cef53f28.html">https://jyxyz.github.io/posts/cef53f28.html</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a" style="display: inline-block;width: 120px"><h>博主✍</h><div class="post-copyright-cc-info"><h>阿耶</h></div></div><div class="post-copyright-c" style="display: inline-block;width: 120px"><h>本篇发布于📚</h><div class="post-copyright-cc-info"><h>2021-10-28</h></div></div><div class="post-copyright-u" style="display: inline-block;width: 120px"><h>本篇更新于🕝</h><div class="post-copyright-cc-info"><h>2021-11-17</h></div></div><div class="post-copyright-c" style="display: inline-block;width: 120px"><h>许可协议</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY 4.0" href="https://creativecommons.org/licenses/by/4.0/deed.zh">CC BY 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MFC/">MFC</a></div><div class="post_share"><div class="social-share" data-image="/img/default.jpg" data-sites="facebook,twitter,wechat,weibo,qq,qzone"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 要饭码</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/reward/wechat.png" target="_blank"><img class="post-qr-code-img" src="/img/reward/wechat.png" alt="wechat饿饿"/></a><div class="post-qr-code-desc">wechat饿饿</div></li><li class="reward-item"><a href="/img/reward/alipay.png" target="_blank"><img class="post-qr-code-img" src="/img/reward/alipay.png" alt="alipay饿饿"/></a><div class="post-qr-code-desc">alipay饿饿</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/4eb9716e.html"><img class="prev-cover" src="/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Windows程序设计</div></div></a></div><div class="next-post pull-right"><a href="/posts/5bf78d14.html"><img class="next-cover" src="/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">PE格式</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#What-is-MFC"><span class="toc-number">1.</span> <span class="toc-text">What is MFC?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Why-MFC"><span class="toc-number">2.</span> <span class="toc-text">Why MFC?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E8%A1%A5%E5%85%85"><span class="toc-number">3.</span> <span class="toc-text">知识补充</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%8F%8A%E9%A1%B9%E7%9B%AE%E5%88%9B%E5%BB%BA"><span class="toc-number">3.1.</span> <span class="toc-text">开发环境及项目创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%88%E7%89%99%E5%88%A9%E5%91%BD%E5%90%8D%E6%B3%95"><span class="toc-number">3.2.</span> <span class="toc-text">匈牙利命名法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows-API%E4%B8%8EMFC%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0"><span class="toc-number">3.3.</span> <span class="toc-text">Windows API与MFC成员函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%AF%87"><span class="toc-number">4.</span> <span class="toc-text">基础篇</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AAMFC%E7%A8%8B%E5%BA%8F%EF%BC%88%E7%AA%97%E4%BD%93%EF%BC%89"><span class="toc-number">4.1.</span> <span class="toc-text">第一个MFC程序（窗体）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MFC%E5%AF%B9%E8%B1%A1%E4%B8%8EWindows%E5%AF%B9%E8%B1%A1"><span class="toc-number">4.2.</span> <span class="toc-text">MFC对象与Windows对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B6%88%E6%81%AF%E6%98%A0%E5%B0%84%EF%BC%9A%E4%BB%8Ewindows%E5%AF%B9%E8%B1%A1%E5%88%B0MFC%E5%AF%B9%E8%B1%A1"><span class="toc-number">4.3.</span> <span class="toc-text">消息映射：从windows对象到MFC对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MFC%E5%AF%B9%E8%B1%A1%E4%B8%8E%E8%B5%84%E6%BA%90%E7%BB%91%E5%AE%9A"><span class="toc-number">4.4.</span> <span class="toc-text">MFC对象与资源绑定</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#App-Wizard%E6%B7%BB%E5%8A%A0%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F%E5%8A%9F%E8%83%BD%E6%BC%94%E7%A4%BA%E4%B8%8E%E5%89%96%E6%9E%90"><span class="toc-number">4.5.</span> <span class="toc-text">App Wizard添加成员变量功能演示与剖析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#App-Wizard%E5%80%BC%E7%B1%BB%E5%9E%8B%E4%B8%8E%E6%8E%A7%E4%BB%B6%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.6.</span> <span class="toc-text">App Wizard值类型与控件类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%AF%9D%E6%A1%86%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1"><span class="toc-number">4.7.</span> <span class="toc-text">对话框应用程序程序设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%87%E5%87%86%E6%8E%A7%E4%BB%B6%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B%EF%BC%9A%E7%BD%91%E9%A1%B5%E7%AE%A1%E7%90%86%E4%B8%93%E5%AE%B6"><span class="toc-number">4.8.</span> <span class="toc-text">标准控件综合案例：网页管理专家</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MFC%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%8A%80%E6%9C%AF"><span class="toc-number">4.9.</span> <span class="toc-text">MFC多线程技术</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#MFC%E7%BA%BF%E7%A8%8B%E6%A6%82%E8%AE%BA"><span class="toc-number">4.9.1.</span> <span class="toc-text">MFC线程概论</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MFC%E7%BA%BF%E7%A8%8B%E6%8A%80%E6%9C%AF%E5%89%96%E6%9E%90"><span class="toc-number">4.9.2.</span> <span class="toc-text">MFC线程技术剖析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%AE%9E%E8%B7%B5%E6%A1%88%E4%BE%8B%EF%BC%9A%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%96%87%E4%BB%B6%E6%90%9C%E7%B4%A2%E5%99%A8"><span class="toc-number">4.9.3.</span> <span class="toc-text">多线程实践案例：多线程文件搜索器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MFC%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%8A%80%E6%9C%AF%EF%BC%88%E7%BA%BF%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1%EF%BC%89"><span class="toc-number">4.10.</span> <span class="toc-text">MFC多线程技术（线程间通信）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B6%88%E6%81%AF%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B%EF%BC%9A%E6%97%A5%E5%BF%97%E5%88%87%E5%89%B2%E5%99%A8"><span class="toc-number">4.11.</span> <span class="toc-text">自定义消息通信机制综合案例：日志切割器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%90%86%E7%AF%87%E4%BA%8C-MFC%E6%A0%B8%E5%BF%83%E6%A1%86%E6%9E%B6%E5%AE%8C%E5%85%A8%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.</span> <span class="toc-text">原理篇二-MFC核心框架完全实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E7%A8%8B%E7%AF%87-MFC%E9%80%9A%E7%94%A8%E6%8A%80%E6%9C%AF"><span class="toc-number">6.</span> <span class="toc-text">工程篇-MFC通用技术</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B-%E6%8B%BC%E5%9B%BE%E6%B8%B8%E6%88%8F"><span class="toc-number">7.</span> <span class="toc-text">综合案例-拼图游戏</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MFC%E6%A1%88%E4%BE%8B-%E8%A7%86%E9%A2%91%E5%9B%BE%E5%83%8F%E6%91%84%E5%83%8F%E5%A4%B4"><span class="toc-number">8.</span> <span class="toc-text">MFC案例-视频图像摄像头</span></a></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'acloudenv-3gdr1re432b1f469',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.vemoji)'))
      }
    }, null))
  }

  const getCount = () => {
    twikoo.getCommentsCount({
      envId: 'acloudenv-3gdr1re432b1f469',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      document.getElementById('twikoo-count').innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end --></body></html>